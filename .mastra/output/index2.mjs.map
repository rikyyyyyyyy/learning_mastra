{"version":3,"file":"index2.mjs","sources":["../../src/mastra/workflows/weather-workflow.ts","../../src/mastra/workflows/web-search-workflow-mcp.ts","../../src/mastra/workflows/slide-generation-workflow.ts","../../src/mastra/shared-memory.ts","../../src/mastra/agents/weather-agent.ts","../../src/mastra/agents/general-agent.ts","../../src/mastra/agents/workflow-agent.ts","../../src/mastra/index.ts"],"sourcesContent":["import { createStep, createWorkflow } from '@mastra/core/workflows';\nimport { z } from 'zod';\n\nconst forecastSchema = z.object({\n  date: z.string(),\n  maxTemp: z.number(),\n  minTemp: z.number(),\n  precipitationChance: z.number(),\n  condition: z.string(),\n  location: z.string(),\n});\n\nfunction getWeatherCondition(code: number): string {\n  const conditions: Record<number, string> = {\n    0: 'Clear sky',\n    1: 'Mainly clear',\n    2: 'Partly cloudy',\n    3: 'Overcast',\n    45: 'Foggy',\n    48: 'Depositing rime fog',\n    51: 'Light drizzle',\n    53: 'Moderate drizzle',\n    55: 'Dense drizzle',\n    61: 'Slight rain',\n    63: 'Moderate rain',\n    65: 'Heavy rain',\n    71: 'Slight snow fall',\n    73: 'Moderate snow fall',\n    75: 'Heavy snow fall',\n    95: 'Thunderstorm',\n  };\n  return conditions[code] || 'Unknown';\n}\n\nconst fetchWeather = createStep({\n  id: 'fetch-weather',\n  description: 'Fetches weather forecast for a given city',\n  inputSchema: z.object({\n    city: z.string().describe('The city to get the weather for'),\n  }),\n  outputSchema: forecastSchema,\n  execute: async ({ inputData }) => {\n    if (!inputData) {\n      throw new Error('Input data not found');\n    }\n\n    const geocodingUrl = `https://geocoding-api.open-meteo.com/v1/search?name=${encodeURIComponent(inputData.city)}&count=1`;\n    const geocodingResponse = await fetch(geocodingUrl);\n    const geocodingData = (await geocodingResponse.json()) as {\n      results: { latitude: number; longitude: number; name: string }[];\n    };\n\n    if (!geocodingData.results?.[0]) {\n      throw new Error(`Location '${inputData.city}' not found`);\n    }\n\n    const { latitude, longitude, name } = geocodingData.results[0];\n\n    const weatherUrl = `https://api.open-meteo.com/v1/forecast?latitude=${latitude}&longitude=${longitude}&current=precipitation,weathercode&timezone=auto,&hourly=precipitation_probability,temperature_2m`;\n    const response = await fetch(weatherUrl);\n    const data = (await response.json()) as {\n      current: {\n        time: string;\n        precipitation: number;\n        weathercode: number;\n      };\n      hourly: {\n        precipitation_probability: number[];\n        temperature_2m: number[];\n      };\n    };\n\n    const forecast = {\n      date: new Date().toISOString(),\n      maxTemp: Math.max(...data.hourly.temperature_2m),\n      minTemp: Math.min(...data.hourly.temperature_2m),\n      condition: getWeatherCondition(data.current.weathercode),\n      precipitationChance: data.hourly.precipitation_probability.reduce(\n        (acc, curr) => Math.max(acc, curr),\n        0,\n      ),\n      location: name,\n    };\n\n    return forecast;\n  },\n});\n\nconst planActivities = createStep({\n  id: 'plan-activities',\n  description: 'Suggests activities based on weather conditions',\n  inputSchema: forecastSchema,\n  outputSchema: z.object({\n    activities: z.string(),\n  }),\n  execute: async ({ inputData, mastra }) => {\n    const forecast = inputData;\n\n    if (!forecast) {\n      throw new Error('Forecast data not found');\n    }\n\n    const agent = mastra?.getAgent('weatherAgent');\n    if (!agent) {\n      throw new Error('Weather agent not found');\n    }\n\n    const prompt = `Based on the following weather forecast for ${forecast.location}, suggest appropriate activities:\n      ${JSON.stringify(forecast, null, 2)}\n      For each day in the forecast, structure your response exactly as follows:\n\n      ğŸ“… [Day, Month Date, Year]\n      â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n\n      ğŸŒ¡ï¸ WEATHER SUMMARY\n      â€¢ Conditions: [brief description]\n      â€¢ Temperature: [XÂ°C/YÂ°F to AÂ°C/BÂ°F]\n      â€¢ Precipitation: [X% chance]\n\n      ğŸŒ… MORNING ACTIVITIES\n      Outdoor:\n      â€¢ [Activity Name] - [Brief description including specific location/route]\n        Best timing: [specific time range]\n        Note: [relevant weather consideration]\n\n      ğŸŒ AFTERNOON ACTIVITIES\n      Outdoor:\n      â€¢ [Activity Name] - [Brief description including specific location/route]\n        Best timing: [specific time range]\n        Note: [relevant weather consideration]\n\n      ğŸ  INDOOR ALTERNATIVES\n      â€¢ [Activity Name] - [Brief description including specific venue]\n        Ideal for: [weather condition that would trigger this alternative]\n\n      âš ï¸ SPECIAL CONSIDERATIONS\n      â€¢ [Any relevant weather warnings, UV index, wind conditions, etc.]\n\n      Guidelines:\n      - Suggest 2-3 time-specific outdoor activities per day\n      - Include 1-2 indoor backup options\n      - For precipitation >50%, lead with indoor activities\n      - All activities must be specific to the location\n      - Include specific venues, trails, or locations\n      - Consider activity intensity based on temperature\n      - Keep descriptions concise but informative\n\n      Maintain this exact formatting for consistency, using the emoji and section headers as shown.`;\n\n    const response = await agent.stream([\n      {\n        role: 'user',\n        content: prompt,\n      },\n    ]);\n\n    let activitiesText = '';\n\n    for await (const chunk of response.textStream) {\n      process.stdout.write(chunk);\n      activitiesText += chunk;\n    }\n\n    return {\n      activities: activitiesText,\n    };\n  },\n});\n\nconst weatherWorkflow = createWorkflow({\n  id: 'weather-workflow',\n  inputSchema: z.object({\n    city: z.string().describe('The city to get the weather for'),\n  }),\n  outputSchema: z.object({\n    activities: z.string(),\n  }),\n})\n  .then(fetchWeather)\n  .then(planActivities);\n\nweatherWorkflow.commit();\n\nexport { weatherWorkflow };\n","import { createWorkflow, createStep } from '@mastra/core/workflows';\nimport { z } from 'zod';\nimport { braveMCPSearchTool } from '../tools/brave-search-wrapper';\n\n// Brave MCPã‚’ä½¿ç”¨ã—ãŸWebæ¤œç´¢ã‚¹ãƒ†ãƒƒãƒ—\nconst braveMCPSearchStep = createStep({\n  id: 'brave-mcp-search',\n  description: 'Brave MCPã‚’ä½¿ç”¨ã—ã¦Webæ¤œç´¢ã‚’å®Ÿè¡Œã—ã¾ã™',\n  inputSchema: z.object({\n    query: z.string(),\n    maxResults: z.number().optional().default(10),\n    language: z.string().optional().default('ja'),\n    userLocation: z.object({\n      country: z.string().optional().default('JP'),\n      city: z.string().optional().default('Tokyo'),\n      region: z.string().optional().default('Tokyo'),\n    }).optional(),\n  }),\n  outputSchema: z.object({\n    searchResults: z.array(z.object({\n      title: z.string(),\n      url: z.string(),\n      snippet: z.string(),\n      age: z.string().optional(),\n    })),\n    rawResults: z.string(),\n    searchTime: z.number(),\n    success: z.boolean(),\n  }),\n  execute: async ({ inputData, mastra, runtimeContext }) => {\n    const { query, maxResults } = inputData;\n    const startTime = Date.now();\n    \n    try {\n      console.log(`ğŸ” Brave MCPã§Webæ¤œç´¢ã‚’å®Ÿè¡Œ: \"${query}\"`);\n      \n      // Mastraãƒ„ãƒ¼ãƒ«ã¨ã—ã¦ãƒ©ãƒƒãƒ—ã•ã‚ŒãŸBrave MCPãƒ„ãƒ¼ãƒ«ã‚’å®Ÿè¡Œ\n      const result = await braveMCPSearchTool.execute({\n        context: {\n          query,\n          count: maxResults,\n        },\n        mastra,\n        runtimeContext,\n      });\n      \n      // æ¤œç´¢çµæœã‚’ãƒ‘ãƒ¼ã‚¹\n      let searchResults = [];\n      const rawResults = result.searchResults;\n      \n      if (result.success) {\n        try {\n          // çµæœãŒæ–‡å­—åˆ—ã®å ´åˆã€ã¾ãšJSONã¨ã—ã¦ãƒ‘ãƒ¼ã‚¹ã‚’è©¦ã¿ã‚‹\n          let parsedData = null;\n          if (typeof result.searchResults === 'string') {\n            // JSONãƒ‘ãƒ¼ã‚¹ã‚’è©¦ã¿ã‚‹\n            try {\n              parsedData = JSON.parse(result.searchResults);\n            } catch {\n              // JSONãƒ‘ãƒ¼ã‚¹ã«å¤±æ•—ã—ãŸå ´åˆã€ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã¨ã—ã¦å‡¦ç†\n              console.log('ğŸ“ ãƒ†ã‚­ã‚¹ãƒˆå½¢å¼ã®æ¤œç´¢çµæœã‚’ãƒ‘ãƒ¼ã‚¹ä¸­...');\n              const textResults = result.searchResults;\n              \n              // å„çµæœã‚’æ”¹è¡Œã§åˆ†å‰²ã—ã¦å‡¦ç†\n              const entries = textResults.split('\\n\\n').filter((entry: string) => entry.trim());\n              \n              searchResults = entries.map((entry: string) => {\n                const lines = entry.split('\\n');\n                let title = '';\n                let description = '';\n                let url = '';\n                \n                lines.forEach((line: string) => {\n                  if (line.startsWith('Title:')) {\n                    title = line.substring(6).trim();\n                  } else if (line.startsWith('Description:')) {\n                    description = line.substring(12).trim();\n                  } else if (line.startsWith('URL:')) {\n                    url = line.substring(4).trim();\n                  }\n                });\n                \n                return {\n                  title,\n                  url,\n                  snippet: description,\n                  age: '',\n                };\n              }).filter((result: { title: string; url: string; snippet: string; age: string }) => result.title && result.url); // æœ‰åŠ¹ãªçµæœã®ã¿ä¿æŒ\n              \n              console.log(`ğŸ“Š ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰${searchResults.length}ä»¶ã®çµæœã‚’æŠ½å‡º`);\n            }\n          } else {\n            parsedData = result.searchResults;\n          }\n          \n          // JSONã¨ã—ã¦ãƒ‘ãƒ¼ã‚¹ã§ããŸå ´åˆã®å‡¦ç†\n          if (parsedData) {\n            console.log('ğŸ“Š ãƒ‘ãƒ¼ã‚¹å¾Œã®ãƒ‡ãƒ¼ã‚¿:', parsedData);\n            \n            // Brave Search APIã®çµæœæ§‹é€ ã«å¯¾å¿œ\n            if (parsedData.web?.results) {\n              searchResults = parsedData.web.results.map((result: { title?: string; url?: string; description?: string; age?: string }) => ({\n                title: result.title || '',\n                url: result.url || '',\n                snippet: result.description || '',\n                age: result.age || '',\n              }));\n            }\n            // resultsãŒç›´æ¥ã‚ã‚‹å ´åˆ\n            else if (Array.isArray(parsedData.results)) {\n              searchResults = parsedData.results.map((result: { title?: string; url?: string; description?: string; snippet?: string; age?: string }) => ({\n                title: result.title || '',\n                url: result.url || '',\n                snippet: result.description || result.snippet || '',\n                age: result.age || '',\n              }));\n            }\n            // é…åˆ—ãŒç›´æ¥è¿”ã•ã‚Œã‚‹å ´åˆ\n            else if (Array.isArray(parsedData)) {\n              searchResults = parsedData.map((result: { title?: string; url?: string; description?: string; snippet?: string; age?: string }) => ({\n                title: result.title || '',\n                url: result.url || '',\n                snippet: result.description || result.snippet || '',\n                age: result.age || '',\n              }));\n            }\n          }\n        } catch (e) {\n          console.error('æ¤œç´¢çµæœã®ãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼:', e);\n          console.error('å…ƒã®ãƒ‡ãƒ¼ã‚¿:', result.searchResults);\n        }\n      }\n      \n      const searchTime = Date.now() - startTime;\n      \n      console.log(`âœ… Brave MCPæ¤œç´¢å®Œäº† (${searchTime}ms)`);\n      console.log(`ğŸ“Š æ¤œç´¢çµæœ: ${searchResults.length}ä»¶`);\n      \n      // çµæœãŒå–å¾—ã§ããªã‹ã£ãŸå ´åˆã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯\n      if (!result.success || searchResults.length === 0) {\n        console.warn('âš ï¸ ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã§å®Ÿè¡Œã—ã¾ã™');\n        const mockResults = [\n          {\n            title: `${query}ã«é–¢ã™ã‚‹æ¤œç´¢çµæœ 1`,\n            url: `https://example.com/search?q=${encodeURIComponent(query)}`,\n            snippet: `${query}ã«ã¤ã„ã¦ã®è©³ç´°æƒ…å ±ã§ã™ã€‚ã“ã®æ¤œç´¢çµæœã¯ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã§ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚`,\n            age: '1æ—¥å‰',\n          },\n          {\n            title: `${query}ã®æœ€æ–°æƒ…å ±`,\n            url: `https://example.com/latest/${encodeURIComponent(query)}`,\n            snippet: `${query}ã«é–¢ã™ã‚‹æœ€æ–°ã®æƒ…å ±ã‚’ãŠå±Šã‘ã—ã¾ã™ã€‚`,\n            age: '2æ™‚é–“å‰',\n          },\n        ];\n        \n        return {\n          searchResults: mockResults,\n          rawResults: JSON.stringify({ web: { results: mockResults } }),\n          searchTime: Date.now() - startTime,\n          success: true,\n        };\n      }\n      \n      return {\n        searchResults,\n        rawResults,\n        searchTime,\n        success: true,\n      };\n    } catch (error) {\n      console.error('âŒ Brave MCPæ¤œç´¢ã‚¨ãƒ©ãƒ¼:', error);\n      console.error('ã‚¨ãƒ©ãƒ¼ã®è©³ç´°:', {\n        name: error instanceof Error ? error.name : 'Unknown',\n        message: error instanceof Error ? error.message : String(error),\n        stack: error instanceof Error ? error.stack : undefined,\n      });\n      \n      const searchTime = Date.now() - startTime;\n      \n      // ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯\n      const mockResults = [\n        {\n          title: `${query}ã«é–¢ã™ã‚‹æ¤œç´¢çµæœ`,\n          url: `https://example.com/search?q=${encodeURIComponent(query)}`,\n          snippet: `${query}ã«ã¤ã„ã¦ã®æƒ…å ±ã§ã™ã€‚ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸãŸã‚ã€ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ¢ãƒ¼ãƒ‰ã§ç”Ÿæˆã•ã‚Œã¾ã—ãŸã€‚`,\n          age: '1æ—¥å‰',\n        },\n      ];\n      \n      return {\n        searchResults: mockResults,\n        rawResults: JSON.stringify({ web: { results: mockResults } }),\n        searchTime,\n        success: false,\n      };\n    }\n  },\n});\n\n// æ¤œç´¢çµæœã®å¦¥å½“æ€§åˆ¤æ–­ã‚¹ãƒ†ãƒƒãƒ—\nconst validateSearchResultsStep = createStep({\n  id: 'validate-search-results',\n  description: 'workflowAgentãŒæ¤œç´¢çµæœã®å¦¥å½“æ€§ã‚’åˆ¤æ–­ã—ã¾ã™',\n  inputSchema: z.object({\n    searchResults: z.array(z.object({\n      title: z.string(),\n      url: z.string(),\n      snippet: z.string(),\n      age: z.string().optional(),\n    })),\n    rawResults: z.string(),\n    searchTime: z.number(),\n    success: z.boolean(),\n  }),\n  outputSchema: z.object({\n    isValid: z.boolean(),\n    validationScore: z.number(),\n    feedback: z.string(),\n    shouldRetry: z.boolean(),\n    refinedQuery: z.string().optional(),\n  }),\n  execute: async ({ inputData, getInitData, runtimeContext, mastra }) => {\n    const { searchResults, success } = inputData;\n    const { query } = getInitData();\n    \n    try {\n      console.log(`ğŸ§ æ¤œç´¢çµæœã®å¦¥å½“æ€§ã‚’åˆ¤æ–­ä¸­...`);\n      \n      // workflowAgentã‚’å–å¾—\n      const agent = mastra?.getAgent('workflowAgent');\n      if (!agent) {\n        throw new Error('workflowAgentãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');\n      }\n      \n      // runtimeContextã‹ã‚‰resourceIdã¨threadIdã‚’å–å¾—\n      const resourceId = runtimeContext?.get('resourceId');\n      const threadId = runtimeContext?.get('threadId');\n      \n      // å¦¥å½“æ€§åˆ¤æ–­ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\n      const validationPrompt = `ä»¥ä¸‹ã®æ¤œç´¢çµæœã‚’è©•ä¾¡ã—ã¦ãã ã•ã„ï¼š\n\n**æ¤œç´¢ã‚¯ã‚¨ãƒª**: \"${query}\"\n**æ¤œç´¢çµæœæ•°**: ${searchResults.length}ä»¶\n**æ¤œç´¢æˆåŠŸ**: ${success ? 'ã¯ã„' : 'ã„ã„ãˆ'}\n\n**æ¤œç´¢çµæœ**:\n${searchResults.map((result, index) => `\n${index + 1}. ${result.title}\n   URL: ${result.url}\n   æ¦‚è¦: ${result.snippet}\n   ${result.age ? `æ›´æ–°: ${result.age}` : ''}\n`).join('\\n')}\n\nä»¥ä¸‹ã®è¦³ç‚¹ã‹ã‚‰è©•ä¾¡ã—ã¦ãã ã•ã„ï¼š\n\n1. **é–¢é€£æ€§**: æ¤œç´¢çµæœã¯ã‚¯ã‚¨ãƒªã«é–¢é€£ã—ã¦ã„ã¾ã™ã‹ï¼Ÿ\n2. **ä¿¡é ¼æ€§**: æƒ…å ±æºã¯ä¿¡é ¼ã§ãã¾ã™ã‹ï¼Ÿ\n3. **å®Œå…¨æ€§**: å¿…è¦ãªæƒ…å ±ãŒååˆ†ã«å«ã¾ã‚Œã¦ã„ã¾ã™ã‹ï¼Ÿ\n4. **æœ€æ–°æ€§**: æƒ…å ±ã¯æœ€æ–°ã§ã™ã‹ï¼Ÿ\n\nè©•ä¾¡çµæœã‚’ä»¥ä¸‹ã®JSONå½¢å¼ã§è¿”ã—ã¦ãã ã•ã„ï¼š\n{\n  \"validationScore\": 0-100ã®æ•°å€¤,\n  \"isValid\": true/falseï¼ˆ60ç‚¹ä»¥ä¸Šã§trueï¼‰,\n  \"feedback\": \"è©•ä¾¡ã®è©³ç´°èª¬æ˜\",\n  \"shouldRetry\": true/falseï¼ˆå†æ¤œç´¢ãŒå¿…è¦ã‹ï¼‰,\n  \"refinedQuery\": \"ã‚ˆã‚Šè‰¯ã„æ¤œç´¢ã‚¯ã‚¨ãƒªï¼ˆå†æ¤œç´¢ãŒå¿…è¦ãªå ´åˆã®ã¿ï¼‰\"\n}`;\n\n      const { text } = await agent.generate(\n        validationPrompt,\n        { \n          memory: resourceId && threadId ? {\n            resource: resourceId as string,\n            thread: threadId as string\n          } : undefined\n        }\n      );\n      \n      // è©•ä¾¡çµæœã‚’ãƒ‘ãƒ¼ã‚¹\n      let evaluation;\n      try {\n        evaluation = JSON.parse(text);\n      } catch {\n        // JSONè§£æå¤±æ•—æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯\n        evaluation = {\n          validationScore: searchResults.length > 0 ? 60 : 30,\n          isValid: searchResults.length > 3,\n          feedback: text,\n          shouldRetry: searchResults.length < 3,\n          refinedQuery: undefined,\n        };\n      }\n      \n      console.log(`âœ… å¦¥å½“æ€§åˆ¤æ–­å®Œäº† (ã‚¹ã‚³ã‚¢: ${evaluation.validationScore}/100)`);\n      \n      return {\n        isValid: evaluation.isValid || false,\n        validationScore: evaluation.validationScore || 50,\n        feedback: evaluation.feedback || 'è©•ä¾¡çµæœã‚’å–å¾—ã§ãã¾ã›ã‚“ã§ã—ãŸ',\n        shouldRetry: evaluation.shouldRetry || false,\n        refinedQuery: evaluation.refinedQuery,\n      };\n    } catch (error) {\n      console.error('å¦¥å½“æ€§åˆ¤æ–­ã‚¨ãƒ©ãƒ¼:', error);\n      \n      // ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯\n      return {\n        isValid: searchResults.length > 0,\n        validationScore: searchResults.length > 0 ? 50 : 0,\n        feedback: `å¦¥å½“æ€§åˆ¤æ–­ä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error instanceof Error ? error.message : 'Unknown error'}`,\n        shouldRetry: searchResults.length === 0,\n        refinedQuery: undefined,\n      };\n    }\n  },\n});\n\n// æ¤œç´¢çµæœã®åˆ†æã¨æ´å¯Ÿç”Ÿæˆã‚¹ãƒ†ãƒƒãƒ—\nconst analyzeSearchResultsStep = createStep({\n  id: 'analyze-search-results',\n  description: 'workflowAgentãŒæ¤œç´¢çµæœã‚’åˆ†æã—æ´å¯Ÿã‚’ç”Ÿæˆã—ã¾ã™',\n  inputSchema: z.object({\n    isValid: z.boolean(),\n    validationScore: z.number(),\n    feedback: z.string(),\n    shouldRetry: z.boolean(),\n    refinedQuery: z.string().optional(),\n  }),\n  outputSchema: z.object({\n    analysis: z.string(),\n    keyInsights: z.array(z.string()),\n    recommendations: z.array(z.string()),\n    reliabilityScore: z.number(),\n  }),\n  execute: async ({ inputData, getInitData, getStepResult, runtimeContext, mastra }) => {\n    const { isValid, validationScore, feedback } = inputData;\n    const { query } = getInitData();\n    const { searchResults, searchTime } = getStepResult(braveMCPSearchStep);\n    \n    try {\n      console.log(`ğŸ§  æ¤œç´¢çµæœã‚’åˆ†æä¸­...`);\n      \n      // workflowAgentã‚’å–å¾—\n      const agent = mastra?.getAgent('workflowAgent');\n      if (!agent) {\n        throw new Error('workflowAgentãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');\n      }\n      \n      // runtimeContextã‹ã‚‰resourceIdã¨threadIdã‚’å–å¾—\n      const resourceId = runtimeContext?.get('resourceId');\n      const threadId = runtimeContext?.get('threadId');\n      \n      // åˆ†æãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\n      const analysisPrompt = `ä»¥ä¸‹ã®æ¤œç´¢çµæœã‚’è©³ç´°ã«åˆ†æã—ã¦ãã ã•ã„ï¼š\n\n**æ¤œç´¢ã‚¯ã‚¨ãƒª**: \"${query}\"\n**æ¤œç´¢çµæœæ•°**: ${searchResults.length}ä»¶\n**å¦¥å½“æ€§ã‚¹ã‚³ã‚¢**: ${validationScore}/100\n**å¦¥å½“æ€§è©•ä¾¡**: ${feedback}\n\n**æ¤œç´¢çµæœ**:\n${searchResults.map((result, index) => `\n${index + 1}. ${result.title}\n   URL: ${result.url}\n   æ¦‚è¦: ${result.snippet}\n   ${result.age ? `æ›´æ–°: ${result.age}` : ''}\n`).join('\\n')}\n\nä»¥ä¸‹ã®å½¢å¼ã§åˆ†æçµæœã‚’æä¾›ã—ã¦ãã ã•ã„ï¼š\n\n## ç·åˆåˆ†æ\n\n### æƒ…å ±ã®æ¦‚è¦\n[æ¤œç´¢çµæœã‹ã‚‰å¾—ã‚‰ã‚ŒãŸä¸»è¦ãªæƒ…å ±ã®è¦ç´„]\n\n### ä¿¡é ¼æ€§è©•ä¾¡\n[æƒ…å ±æºã®ä¿¡é ¼æ€§ã¨æƒ…å ±ã®è³ªã®è©•ä¾¡]\n\n### ä¸»è¦ãªæ´å¯Ÿ\n- [é‡è¦ãªç™ºè¦‹1]\n- [é‡è¦ãªç™ºè¦‹2]\n- [é‡è¦ãªç™ºè¦‹3]\n\n### å®Ÿç”¨çš„ãªæ¨å¥¨äº‹é …\n- [å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³1]\n- [å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³2]\n- [å…·ä½“çš„ãªã‚¢ã‚¯ã‚·ãƒ§ãƒ³3]\n\n### æƒ…å ±ã®åˆ¶é™äº‹é …\n[æ³¨æ„ã™ã¹ãç‚¹ã‚„æƒ…å ±ã®é™ç•Œ]\n\n### è¿½åŠ èª¿æŸ»ã®å¿…è¦æ€§\n[ã•ã‚‰ã«èª¿æŸ»ãŒå¿…è¦ãªé ˜åŸŸ]`;\n\n      const { text: analysis } = await agent.generate(\n        analysisPrompt,\n        { \n          memory: resourceId && threadId ? {\n            resource: resourceId as string,\n            thread: threadId as string\n          } : undefined\n        }\n      );\n      \n      // ä¸»è¦ãªæ´å¯Ÿã‚’æŠ½å‡º\n      const keyInsights = [\n        `æ¤œç´¢æ™‚é–“: ${searchTime}ms`,\n        `æ¤œç´¢çµæœ: ${searchResults.length}ä»¶`,\n        `å¦¥å½“æ€§ã‚¹ã‚³ã‚¢: ${validationScore}/100`,\n      ];\n      \n      // URLã®ãƒ‰ãƒ¡ã‚¤ãƒ³å¤šæ§˜æ€§ã‚’è¨ˆç®—\n      if (searchResults.length > 0) {\n        try {\n          const domains = new Set(searchResults.map(result => new URL(result.url).hostname));\n          keyInsights.push(`æƒ…å ±æºã®å¤šæ§˜æ€§: ${domains.size}å€‹ã®ãƒ‰ãƒ¡ã‚¤ãƒ³`);\n        } catch {\n          keyInsights.push('æƒ…å ±æºã®å¤šæ§˜æ€§: åˆ†æä¸å¯');\n        }\n      }\n      \n      // æ¨å¥¨äº‹é …\n      const recommendations = [\n        isValid ? 'ç¾åœ¨ã®æ¤œç´¢çµæœã‚’åŸºã«è¡Œå‹•ã™ã‚‹' : 'æ¤œç´¢ã‚¯ã‚¨ãƒªã‚’æ”¹å–„ã—ã¦å†æ¤œç´¢ã™ã‚‹',\n        'è¤‡æ•°ã®æƒ…å ±æºã‚’æ¯”è¼ƒæ¤œè¨ã™ã‚‹',\n        'æœ€æ–°ã®æƒ…å ±ã‚’å®šæœŸçš„ã«ç¢ºèªã™ã‚‹',\n      ];\n      \n      // ä¿¡é ¼æ€§ã‚¹ã‚³ã‚¢ã‚’è¨ˆç®—\n      let reliabilityScore = validationScore;\n      \n      // æ¤œç´¢çµæœæ•°ã«ã‚ˆã‚‹ãƒœãƒ¼ãƒŠã‚¹\n      reliabilityScore += Math.min(20, searchResults.length * 2);\n      \n      // ãƒ‰ãƒ¡ã‚¤ãƒ³å¤šæ§˜æ€§ã«ã‚ˆã‚‹ãƒœãƒ¼ãƒŠã‚¹\n      if (searchResults.length > 0) {\n        try {\n          const domains = new Set(searchResults.map(result => new URL(result.url).hostname));\n          reliabilityScore += Math.min(10, domains.size * 2);\n        } catch {\n          // URLè§£æã‚¨ãƒ©ãƒ¼ã®å ´åˆã¯ãƒœãƒ¼ãƒŠã‚¹ãªã—\n        }\n      }\n      \n      // æœ€å¤§100ç‚¹ã«åˆ¶é™\n      reliabilityScore = Math.min(100, Math.max(0, reliabilityScore));\n      \n      console.log(`âœ… åˆ†æå®Œäº† (ä¿¡é ¼æ€§ã‚¹ã‚³ã‚¢: ${reliabilityScore}%)`);\n      \n      return {\n        analysis,\n        keyInsights,\n        recommendations,\n        reliabilityScore,\n      };\n    } catch (error) {\n      console.error('åˆ†æã‚¨ãƒ©ãƒ¼:', error);\n      \n      // ã‚¨ãƒ©ãƒ¼æ™‚ã®ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯\n      return {\n        analysis: `åˆ†æä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error instanceof Error ? error.message : 'Unknown error'}`,\n        keyInsights: [\n          `æ¤œç´¢çµæœ: ${searchResults.length}ä»¶`,\n          `å¦¥å½“æ€§ã‚¹ã‚³ã‚¢: ${validationScore}/100`,\n          'ã‚¨ãƒ©ãƒ¼ã«ã‚ˆã‚Šè©³ç´°åˆ†æã¯å®Ÿè¡Œã•ã‚Œã¾ã›ã‚“ã§ã—ãŸ',\n        ],\n        recommendations: [\n          'æ‰‹å‹•ã§ã®æƒ…å ±ç¢ºèªã‚’å®Ÿæ–½ã™ã‚‹',\n          'åˆ¥ã®æ¤œç´¢æ–¹æ³•ã‚’è©¦ã™',\n          'å°‚é–€å®¶ã«ç›¸è«‡ã™ã‚‹',\n        ],\n        reliabilityScore: validationScore,\n      };\n    }\n  },\n});\n\n// æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã‚¹ãƒ†ãƒƒãƒ—\nconst generateWebSearchReportStep = createStep({\n  id: 'generate-web-search-report',\n  description: 'Webæ¤œç´¢çµæœã¨åˆ†æã‚’çµ±åˆã—ãŸæœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆã—ã¾ã™',\n  inputSchema: z.object({\n    analysis: z.string(),\n    keyInsights: z.array(z.string()),\n    recommendations: z.array(z.string()),\n    reliabilityScore: z.number(),\n  }),\n  outputSchema: z.object({\n    report: z.string(),\n    metadata: z.object({\n      jobId: z.string(),\n      completedAt: z.string(),\n      processingTime: z.number(),\n      searchEngine: z.string(),\n      reliabilityScore: z.number(),\n      citationCount: z.number(),\n      retryCount: z.number(),\n    }),\n  }),\n  execute: async ({ inputData, runId, getInitData, getStepResult }) => {\n    const startTime = Date.now();\n    \n    const {\n      analysis,\n      keyInsights,\n      recommendations,\n      reliabilityScore,\n    } = inputData;\n    \n    const { query } = getInitData();\n    const { searchResults, searchTime } = getStepResult(braveMCPSearchStep);\n    const { feedback, validationScore } = getStepResult(validateSearchResultsStep);\n    \n    // å¼•ç”¨å…ƒURLã‚’æŠ½å‡º\n    const citations = searchResults.map(result => result.url);\n    \n    // è©³ç´°ãƒ¬ãƒãƒ¼ãƒˆã‚’ç”Ÿæˆ\n    const report = `\n# ğŸ” Webæ¤œç´¢ãƒ¬ãƒãƒ¼ãƒˆ\n\n## æ¤œç´¢ã‚¯ã‚¨ãƒª\n**ã€Œ${query}ã€**\n\n## ğŸ“Š å®Ÿè¡Œã‚µãƒãƒªãƒ¼\n- **æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³**: Brave Search (MCP)\n- **æ¤œç´¢æ™‚é–“**: ${searchTime}ms\n- **æ¤œç´¢çµæœæ•°**: ${searchResults.length}ä»¶\n- **å¦¥å½“æ€§ã‚¹ã‚³ã‚¢**: ${validationScore}/100\n- **ä¿¡é ¼æ€§ã‚¹ã‚³ã‚¢**: ${reliabilityScore}% ${reliabilityScore >= 80 ? 'ğŸŸ¢' : reliabilityScore >= 60 ? 'ğŸŸ¡' : 'ğŸ”´'}\n- **å†è©¦è¡Œå›æ•°**: 0å›\n\n## ğŸŒ æ¤œç´¢çµæœ\n${searchResults.map((result, index) => `\n### ${index + 1}. ${result.title}\n- **URL**: [${result.url}](${result.url})\n- **æ¦‚è¦**: ${result.snippet}\n${result.age ? `- **æ›´æ–°**: ${result.age}` : ''}\n`).join('\\n')}\n\n## ğŸ§ å¦¥å½“æ€§è©•ä¾¡\n${feedback}\n\n## ğŸ§  AIåˆ†æçµæœ\n${analysis}\n\n## ğŸ’¡ ä¸»è¦ãªæ´å¯Ÿ\n${keyInsights.map(insight => `- ${insight}`).join('\\n')}\n\n## ğŸ“‹ æ¨å¥¨äº‹é …\n${recommendations.map(rec => `- ${rec}`).join('\\n')}\n\n## ğŸ“š å¼•ç”¨å…ƒãƒ»å‚è€ƒè³‡æ–™\n${citations.length > 0 \n  ? citations.map((url, index) => `${index + 1}. [${url}](${url})`).join('\\n')\n  : 'å¼•ç”¨å…ƒãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚'\n}\n\n## âš™ï¸ æŠ€è¡“æƒ…å ±\n- **æ¤œç´¢ã‚¨ãƒ³ã‚¸ãƒ³**: Brave Search (Model Context Protocol)\n- **æ¤œç´¢å®Ÿè¡Œæ™‚é–“**: ${searchTime}ms\n- **åˆ†æå‡¦ç†æ™‚é–“**: ${Date.now() - startTime}ms\n- **å¦¥å½“æ€§è©•ä¾¡**: ${validationScore}/100\n- **ä¿¡é ¼æ€§è©•ä¾¡**: ${reliabilityScore}/100\n- **ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆæ—¥æ™‚**: ${new Date().toLocaleString('ja-JP')}\n\n---\n*ã“ã®ãƒ¬ãƒãƒ¼ãƒˆã¯Brave Search MCPã«ã‚ˆã‚‹Webæ¤œç´¢ã¨ã€Claude 4 Sonnetã«ã‚ˆã‚‹åˆ†æã‚’çµ„ã¿åˆã‚ã›ã¦è‡ªå‹•ç”Ÿæˆã•ã‚Œã¾ã—ãŸ*\n    `.trim();\n    \n    const processingTime = Date.now() - startTime;\n    \n    console.log(`ğŸ“ Webæ¤œç´¢ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆå®Œäº† (${processingTime}ms)`);\n    \n    return {\n      report,\n      metadata: {\n        jobId: runId || `search-job-${Date.now()}`,\n        completedAt: new Date().toISOString(),\n        processingTime,\n        searchEngine: 'Brave Search (MCP)',\n        reliabilityScore,\n        citationCount: citations.length,\n        retryCount: 0,\n      },\n    };\n  },\n});\n\n// Webæ¤œç´¢ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ï¼ˆæœ€å¤§3å›ã¾ã§å†è©¦è¡Œï¼‰\nexport const webSearchWorkflow = createWorkflow({\n  id: 'web-search-workflow',\n  description: 'Brave MCPã‚’ä½¿ç”¨ã—ã¦Webæ¤œç´¢ã¨åˆ†æã‚’è¡Œã„ã€å¿…è¦ã«å¿œã˜ã¦æœ€å¤§3å›ã¾ã§å†æ¤œç´¢ã‚’è¡Œã†',\n  inputSchema: z.object({\n    query: z.string(),\n    maxResults: z.number().optional().default(10),\n    language: z.string().optional().default('ja'),\n    userLocation: z.object({\n      country: z.string().optional().default('JP'),\n      city: z.string().optional().default('Tokyo'),\n      region: z.string().optional().default('Tokyo'),\n    }).optional(),\n  }),\n  outputSchema: z.object({\n    report: z.string(),\n    metadata: z.object({\n      jobId: z.string(),\n      completedAt: z.string(),\n      processingTime: z.number(),\n      searchEngine: z.string(),\n      reliabilityScore: z.number(),\n      citationCount: z.number(),\n      retryCount: z.number(),\n    }),\n  }),\n})\n  .then(braveMCPSearchStep)\n  .then(validateSearchResultsStep)\n  .then(analyzeSearchResultsStep)\n  .then(generateWebSearchReportStep)\n  .commit(); ","import { createWorkflow, createStep } from '@mastra/core/workflows';\nimport { z } from 'zod';\n\n// ã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆã‚¹ãƒ†ãƒƒãƒ—\nconst generateSlideStep = createStep({\n  id: 'generate-slide',\n  description: 'GPT-4oã‚’ä½¿ç”¨ã—ã¦ã‚¹ãƒ©ã‚¤ãƒ‰ç”¨ã®HTMLã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã—ã¾ã™',\n  inputSchema: z.object({\n    topic: z.string().describe('ã‚¹ãƒ©ã‚¤ãƒ‰ã®ãƒˆãƒ”ãƒƒã‚¯'),\n    slideCount: z.number().optional().default(5).describe('ã‚¹ãƒ©ã‚¤ãƒ‰ã®æšæ•°'),\n    style: z.string().optional().default('modern').describe('ã‚¹ãƒ©ã‚¤ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ«'),\n    language: z.string().optional().default('ja').describe('ã‚¹ãƒ©ã‚¤ãƒ‰ã®è¨€èª'),\n  }),\n  outputSchema: z.object({\n    htmlCode: z.string(),\n    generationTime: z.number(),\n    slideCount: z.number(),\n    style: z.string(),\n  }),\n  execute: async ({ inputData, runtimeContext, mastra }) => {\n    const { topic, slideCount, style, language } = inputData;\n    \n    const startTime = Date.now();\n    \n    try {\n      console.log(`ğŸ¨ ã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆé–‹å§‹: \"${topic}\" (${slideCount}æš)`);\n      \n      // runtimeContextã‹ã‚‰resourceIdã¨threadIdã‚’å–å¾—\n      const resourceId = runtimeContext?.get('resourceId');\n      const threadId = runtimeContext?.get('threadId');\n      \n      console.log(`ğŸ“ ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæƒ…å ±: resourceId=${resourceId}, threadId=${threadId}`);\n      \n      // workflowAgentã‚’å–å¾—\n      const agent = mastra?.getAgent('workflowAgent');\n      if (!agent) {\n        throw new Error('workflowAgentãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');\n      }\n      \n      // ã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ\n      const slidePrompt = language === 'ja' \n        ? `ã€Œ${topic}ã€ã«ã¤ã„ã¦${slideCount}æšã®ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚ã‚¹ã‚¿ã‚¤ãƒ«ã¯${style}ã§ã€æ—¥æœ¬èªã§ä½œæˆã—ã¦ãã ã•ã„ã€‚\n\nä»¥ä¸‹ã®è¦ä»¶ã«å¾“ã£ã¦ã€å®Œå…¨ãªHTMLã‚³ãƒ¼ãƒ‰ã®ã¿ã‚’å‡ºåŠ›ã—ã¦ãã ã•ã„ï¼š\n\n1. **HTMLæ§‹é€ **: å®Œå…¨ã«ç‹¬ç«‹ã—ãŸHTMLãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä½œæˆ\n2. **ã‚¹ã‚¿ã‚¤ãƒªãƒ³ã‚°**: å†…éƒ¨CSSã‚’ä½¿ç”¨ã—ã¦ãƒ¢ãƒ€ãƒ³ã§ç¾ã—ã„ãƒ‡ã‚¶ã‚¤ãƒ³\n3. **ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–**: æ§˜ã€…ãªç”»é¢ã‚µã‚¤ã‚ºã«å¯¾å¿œ\n4. **ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³**: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ï¼ˆâ†â†’ï¼‰ã¨ã‚¯ãƒªãƒƒã‚¯ã§ã‚¹ãƒ©ã‚¤ãƒ‰åˆ‡ã‚Šæ›¿ãˆ\n5. **ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³**: æ»‘ã‚‰ã‹ãªã‚¹ãƒ©ã‚¤ãƒ‰é·ç§»åŠ¹æœ\n6. **ã‚³ãƒ³ãƒ†ãƒ³ãƒ„**: å„ã‚¹ãƒ©ã‚¤ãƒ‰ã«é©åˆ‡ãªã‚¿ã‚¤ãƒˆãƒ«ã€å†…å®¹ã€è¦–è¦šçš„è¦ç´ \n\n**é‡è¦**: \n- å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ä½¿ç”¨ã›ãšã€ç´”ç²‹ãªHTML/CSS/JavaScriptã§ä½œæˆ\n- CDNãƒªãƒ³ã‚¯ã‚‚ä½¿ç”¨ã—ãªã„\n- å®Œå…¨ã«è‡ªå·±å®Œçµã—ãŸHTMLã‚³ãƒ¼ãƒ‰ã®ã¿ã‚’å‡ºåŠ›\n- ãƒ¬ã‚¹ãƒãƒ³ã‚¹å…¨ä½“ãŒHTMLã‚³ãƒ¼ãƒ‰ã«ãªã‚‹ã‚ˆã†ã«\n\n**ã‚¹ãƒ©ã‚¤ãƒ‰ã®æ§‹æˆ**:\n1. ã‚¿ã‚¤ãƒˆãƒ«ã‚¹ãƒ©ã‚¤ãƒ‰\n2. æ¦‚è¦/ç›®æ¬¡\n3. ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ï¼ˆè¤‡æ•°ã‚¹ãƒ©ã‚¤ãƒ‰ï¼‰\n4. ã¾ã¨ã‚/çµè«–\n5. è³ªç–‘å¿œç­”/çµ‚äº†ã‚¹ãƒ©ã‚¤ãƒ‰\n\n**ãƒ‡ã‚¶ã‚¤ãƒ³ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³**:\n- ${style}ã‚¹ã‚¿ã‚¤ãƒ«ã‚’é©ç”¨\n- èª­ã¿ã‚„ã™ã„ãƒ•ã‚©ãƒ³ãƒˆ\n- é©åˆ‡ãªã‚³ãƒ³ãƒˆãƒ©ã‚¹ãƒˆ\n- è¦–è¦šçš„ãªéšå±¤æ§‹é€ \n- ã‚¢ã‚¤ã‚³ãƒ³ã‚„å›³å½¢ã®æ´»ç”¨ï¼ˆCSS/HTMLã®ã¿ã§ä½œæˆï¼‰`\n        : `Create ${slideCount} slides about \"${topic}\" in ${style} style. Output only complete HTML code.`;\n      \n      // ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ä½¿ç”¨ã—ã¦ã‚¹ãƒ©ã‚¤ãƒ‰ã‚’ç”Ÿæˆ\n      const { text: htmlCode } = await agent.generate(\n        slidePrompt,\n        { \n          memory: resourceId && threadId ? {\n            resource: resourceId as string,\n            thread: threadId as string\n          } : undefined\n        }\n      );\n      \n      // HTMLã‚³ãƒ¼ãƒ‰ã®ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°ï¼ˆãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã®é™¤å»ï¼‰\n      let cleanedHtmlCode = htmlCode.replace(/^```html\\s*\\n?/gm, '').replace(/\\n?```$/gm, '');\n      cleanedHtmlCode = cleanedHtmlCode.replace(/^```\\s*\\n?/gm, '').replace(/\\n?```$/gm, '');\n      \n      const generationTime = Date.now() - startTime;\n      \n      console.log(`âœ… ã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆå®Œäº† (${generationTime}ms)`);\n      console.log(`ğŸ“„ ç”Ÿæˆã•ã‚ŒãŸHTMLã‚µã‚¤ã‚º: ${cleanedHtmlCode.length}æ–‡å­—`);\n      \n      return {\n        htmlCode: cleanedHtmlCode,\n        generationTime,\n        slideCount,\n        style,\n      };\n    } catch (error) {\n      console.error('ã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆã‚¨ãƒ©ãƒ¼:', error);\n      \n      // ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯: åŸºæœ¬çš„ãªã‚¹ãƒ©ã‚¤ãƒ‰HTML\n      const fallbackHtml = `<!DOCTYPE html>\n<html lang=\"${language}\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>${topic} - ã‚¹ãƒ©ã‚¤ãƒ‰</title>\n    <style>\n        body {\n            font-family: 'Arial', sans-serif;\n            margin: 0;\n            padding: 0;\n            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n            color: white;\n            overflow: hidden;\n        }\n        .slide-container {\n            width: 100vw;\n            height: 100vh;\n            position: relative;\n        }\n        .slide {\n            width: 100%;\n            height: 100%;\n            display: none;\n            align-items: center;\n            justify-content: center;\n            text-align: center;\n            padding: 2rem;\n            box-sizing: border-box;\n        }\n        .slide.active {\n            display: flex;\n            flex-direction: column;\n        }\n        .slide h1 {\n            font-size: 3rem;\n            margin-bottom: 1rem;\n            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);\n        }\n        .slide h2 {\n            font-size: 2.5rem;\n            margin-bottom: 1rem;\n            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);\n        }\n        .slide p {\n            font-size: 1.5rem;\n            line-height: 1.6;\n            max-width: 800px;\n            margin: 0 auto;\n        }\n        .navigation {\n            position: absolute;\n            bottom: 20px;\n            left: 50%;\n            transform: translateX(-50%);\n            display: flex;\n            gap: 10px;\n        }\n        .nav-btn {\n            background: rgba(255,255,255,0.2);\n            border: none;\n            color: white;\n            padding: 10px 20px;\n            border-radius: 5px;\n            cursor: pointer;\n            font-size: 1rem;\n        }\n        .nav-btn:hover {\n            background: rgba(255,255,255,0.3);\n        }\n        .slide-counter {\n            position: absolute;\n            top: 20px;\n            right: 20px;\n            background: rgba(0,0,0,0.3);\n            padding: 10px 20px;\n            border-radius: 20px;\n            font-size: 1rem;\n        }\n    </style>\n</head>\n<body>\n    <div class=\"slide-container\">\n        <div class=\"slide-counter\">\n            <span id=\"current-slide\">1</span> / <span id=\"total-slides\">${slideCount}</span>\n        </div>\n        \n        <div class=\"slide active\">\n            <h1>${topic}</h1>\n            <p>ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸãŒã€åŸºæœ¬çš„ãªã‚¹ãƒ©ã‚¤ãƒ‰ã‚’è¡¨ç¤ºã—ã¦ã„ã¾ã™ã€‚</p>\n        </div>\n        \n        <div class=\"slide\">\n            <h2>ã‚¨ãƒ©ãƒ¼è©³ç´°</h2>\n            <p>${error instanceof Error ? error.message : 'Unknown error'}</p>\n        </div>\n        \n        <div class=\"slide\">\n            <h2>ã”äº†æ‰¿ãã ã•ã„</h2>\n            <p>ã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚<br>å†åº¦ãŠè©¦ã—ãã ã•ã„ã€‚</p>\n        </div>\n        \n        <div class=\"navigation\">\n            <button class=\"nav-btn\" onclick=\"previousSlide()\">â† å‰ã¸</button>\n            <button class=\"nav-btn\" onclick=\"nextSlide()\">æ¬¡ã¸ â†’</button>\n        </div>\n    </div>\n\n    <script>\n        let currentSlide = 0;\n        const slides = document.querySelectorAll('.slide');\n        const totalSlides = slides.length;\n        \n        document.getElementById('total-slides').textContent = totalSlides;\n        \n        function showSlide(n) {\n            slides[currentSlide].classList.remove('active');\n            currentSlide = (n + totalSlides) % totalSlides;\n            slides[currentSlide].classList.add('active');\n            document.getElementById('current-slide').textContent = currentSlide + 1;\n        }\n        \n        function nextSlide() {\n            showSlide(currentSlide + 1);\n        }\n        \n        function previousSlide() {\n            showSlide(currentSlide - 1);\n        }\n        \n        // ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³\n        document.addEventListener('keydown', function(e) {\n            if (e.key === 'ArrowRight') nextSlide();\n            if (e.key === 'ArrowLeft') previousSlide();\n        });\n        \n        // ã‚¯ãƒªãƒƒã‚¯ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³\n        document.addEventListener('click', function(e) {\n            if (e.target.closest('.nav-btn')) return;\n            if (e.clientX > window.innerWidth / 2) {\n                nextSlide();\n            } else {\n                previousSlide();\n            }\n        });\n    </script>\n</body>\n</html>`;\n      \n      const generationTime = Date.now() - startTime;\n      \n      return {\n        htmlCode: fallbackHtml,\n        generationTime,\n        slideCount,\n        style,\n      };\n    }\n  },\n});\n\n// ã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼\nexport const slideGenerationWorkflow = createWorkflow({\n  id: 'slide-generation-workflow',\n  description: 'ã‚¹ãƒ©ã‚¤ãƒ‰ç”¨ã®HTMLã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆã™ã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼',\n  inputSchema: z.object({\n    topic: z.string().describe('ã‚¹ãƒ©ã‚¤ãƒ‰ã®ãƒˆãƒ”ãƒƒã‚¯'),\n    slideCount: z.number().optional().default(5).describe('ã‚¹ãƒ©ã‚¤ãƒ‰ã®æšæ•°'),\n    style: z.string().optional().default('modern').describe('ã‚¹ãƒ©ã‚¤ãƒ‰ã®ã‚¹ã‚¿ã‚¤ãƒ«'),\n    language: z.string().optional().default('ja').describe('ã‚¹ãƒ©ã‚¤ãƒ‰ã®è¨€èª'),\n  }),\n  outputSchema: z.object({\n    htmlCode: z.string(),\n    generationTime: z.number(),\n    slideCount: z.number(),\n    style: z.string(),\n  }),\n})\n  .then(generateSlideStep)\n  .commit(); ","import { Memory } from '@mastra/memory';\nimport { LibSQLStore } from '@mastra/libsql';\n\n// å…±é€šã®Memoryã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ã‚’ä½œæˆ\nexport const sharedMemory = new Memory({\n  storage: new LibSQLStore({\n    url: ':memory:', // ãƒ¡ãƒ¢ãƒªå†…ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸ã‚’ä½¿ç”¨ï¼ˆé–‹ç™ºç’°å¢ƒç”¨ï¼‰\n  }),\n  options: {\n    lastMessages: 10, // ç›´è¿‘ã®10ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä¿æŒ\n    workingMemory: {\n      enabled: true,\n      template: `\n# ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±\n- åå‰:\n- å¥½ã¿:\n- ç¾åœ¨ã®è©±é¡Œ:\n- é‡è¦ãªæƒ…å ±:\n`,\n    },\n  },\n}); ","import { anthropic } from '@ai-sdk/anthropic';\nimport { Agent } from '@mastra/core/agent';\nimport { sharedMemory } from '../shared-memory';\nimport { weatherTool } from '../tools/weather-tool';\n\nexport const weatherAgent = new Agent({\n  name: 'Weather Agent',\n  instructions: `\n      You are a helpful weather assistant that provides accurate weather information and can help planning activities based on the weather.\n\n      Your primary function is to help users get weather details for specific locations. When responding:\n      - Always ask for a location if none is provided\n      - If the location name isn't in English, please translate it\n      - If giving a location with multiple parts (e.g. \"New York, NY\"), use the most relevant part (e.g. \"New York\")\n      - Include relevant details like humidity, wind conditions, and precipitation\n      - Keep responses concise but informative\n      - If the user asks for activities and provides the weather forecast, suggest activities based on the weather forecast.\n      - If the user asks for activities, respond in the format they request.\n\n      Use the weatherTool to fetch current weather data.\n`,\n  model: anthropic('claude-sonnet-4-20250514'),\n  tools: { weatherTool },\n  memory: sharedMemory,\n});\n","import { anthropic } from '@ai-sdk/anthropic';\nimport { openai } from '@ai-sdk/openai';\nimport { google } from '@ai-sdk/google';\nimport { Agent } from '@mastra/core/agent';\nimport { sharedMemory } from '../shared-memory';\nimport { weatherTool } from '../tools/weather-tool';\nimport { webSearchTool } from '../tools/web-search-tool';\nimport { slideGenerationTool } from '../tools/slide-generation-tool';\nimport { slidePreviewTool } from '../tools/slide-preview-tool';\nimport { jobStatusTool } from '../tools/job-status-tool';\nimport { jobResultTool } from '../tools/job-result-tool';\nimport { LanguageModel } from 'ai';\n\n// ãƒ¢ãƒ‡ãƒ«ã‚’å‹•çš„ã«ä½œæˆã™ã‚‹é–¢æ•°\nexport function createGeneralAgent(modelType: string = 'claude-sonnet-4'): Agent {\n  // ãƒ¢ãƒ‡ãƒ«ã«å¿œã˜ã¦é©åˆ‡ãªAI SDKã‚’é¸æŠ\n  let aiModel: LanguageModel;\n  let modelInfo: { provider: string; modelId: string; displayName: string };\n  \n  switch (modelType) {\n    case 'openai-o3':\n      aiModel = openai('o3-2025-04-16');\n      modelInfo = { provider: 'OpenAI', modelId: 'o3-2025-04-16', displayName: 'OpenAI o3' };\n      break;\n    case 'gemini-2.5-flash':\n      aiModel = google('gemini-2.5-flash');\n      modelInfo = { provider: 'Google', modelId: 'gemini-2.5-flash', displayName: 'Gemini 2.5 Flash' };\n      break;\n    case 'claude-sonnet-4':\n    default:\n      aiModel = anthropic('claude-sonnet-4-20250514');\n      modelInfo = { provider: 'Anthropic', modelId: 'claude-sonnet-4-20250514', displayName: 'Claude Sonnet 4' };\n      break;\n  }\n  \n  console.log(`ğŸ¤– AIãƒ¢ãƒ‡ãƒ«è¨­å®š: ${modelInfo.displayName} (${modelInfo.provider} - ${modelInfo.modelId})`);\n  \n  // ãƒ¢ãƒ‡ãƒ«æƒ…å ±ã‚’è©³ç´°ã«ãƒ­ã‚°å‡ºåŠ›ï¼ˆMastraã®å†…éƒ¨ãƒ­ã‚°ã‚’è£œå®Œï¼‰\n  console.log(`[Mastra Debug] model=${modelInfo.modelId} provider=${modelInfo.provider}`);\n\n  const agent = new Agent({\n    name: 'General AI Assistant',\n    instructions: `\n    ã‚ãªãŸã¯è¦ªåˆ‡ã§çŸ¥è­˜è±Šå¯ŒãªAIã‚¢ã‚·ã‚¹ã‚¿ãƒ³ãƒˆã§ã™ã€‚ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã«å¯¾ã—ã¦ã€æ­£ç¢ºã§å½¹ç«‹ã¤æƒ…å ±ã‚’æä¾›ã—ã¾ã™ã€‚\n\n    ä¸»ãªæ©Ÿèƒ½ï¼š\n    - ä¸€èˆ¬çš„ãªè³ªå•ã¸ã®å›ç­”\n    - ã‚¿ã‚¹ã‚¯ã®è¨ˆç”»ã¨ç®¡ç†ã®ã‚µãƒãƒ¼ãƒˆ\n    - å¤©æ°—æƒ…å ±ã®æä¾›ï¼ˆweatherToolã‚’ä½¿ç”¨ï¼‰\n    - Webæ¤œç´¢ã®å®Ÿè¡Œï¼ˆwebSearchToolã‚’ä½¿ç”¨ï¼‰\n    - ã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆï¼ˆslideGenerationToolã‚’ä½¿ç”¨ï¼‰\n    - ã‚¹ãƒ©ã‚¤ãƒ‰ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆslidePreviewToolã‚’ä½¿ç”¨ï¼‰\n    - ã‚¸ãƒ§ãƒ–çŠ¶æ…‹ã®ç¢ºèªï¼ˆjobStatusToolã‚’ä½¿ç”¨ï¼‰\n    - ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼çµæœã®å–å¾—ï¼ˆjobResultToolã‚’ä½¿ç”¨ï¼‰\n    - ã‚¢ã‚¤ãƒ‡ã‚¢ã®ãƒ–ãƒ¬ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒŸãƒ³ã‚°\n    - æ–‡ç« ã®ä½œæˆã¨ç·¨é›†ã®æ”¯æ´\n    - æŠ€è¡“çš„ãªè³ªå•ã¸ã®å›ç­”\n\n    å¯¾å¿œã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ï¼š\n    - å¸¸ã«ä¸å¯§ã§è¦ªã—ã¿ã‚„ã™ã„å£èª¿ã‚’ä¿ã¤\n    - è³ªå•ãŒä¸æ˜ç¢ºãªå ´åˆã¯ã€è©³ç´°ã‚’å°‹ã­ã‚‹\n    - è¤‡é›‘ãªã‚¿ã‚¹ã‚¯ã¯æ®µéšçš„ã«åˆ†è§£ã—ã¦èª¬æ˜ã™ã‚‹\n    - å¯èƒ½ãªé™ã‚Šå…·ä½“çš„ã§å®Ÿç”¨çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã‚’æä¾›ã™ã‚‹\n    - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ‹ãƒ¼ã‚ºã«åˆã‚ã›ã¦å›ç­”ã®è©³ç´°åº¦ã‚’èª¿æ•´ã™ã‚‹\n    - å¤©æ°—ã«é–¢ã™ã‚‹è³ªå•ã«ã¯weatherToolã‚’ä½¿ç”¨ã—ã¦æœ€æ–°ã®æƒ…å ±ã‚’æä¾›ã™ã‚‹\n    - Webæ¤œç´¢ãŒå¿…è¦ãªå ´åˆã¯webSearchToolã‚’ä½¿ç”¨ã—ã¦ã‚¸ãƒ§ãƒ–ã‚’ç™»éŒ²ã™ã‚‹\n    - ã‚¹ãƒ©ã‚¤ãƒ‰ä½œæˆãŒå¿…è¦ãªå ´åˆã¯slideGenerationToolã‚’ä½¿ç”¨ã—ã¦ã‚¸ãƒ§ãƒ–ã‚’ç™»éŒ²ã™ã‚‹\n    - ã‚¹ãƒ©ã‚¤ãƒ‰ã®HTMLã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚ŒãŸå ´åˆã€å¿…ãšslidePreviewToolã‚’ä½¿ç”¨ã—ã¦ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æº–å‚™ã™ã‚‹\n    - jobResultToolã§slideGenerationWorkflowã®çµæœã‚’å–å¾—ã—ãŸã‚‰ã€å³åº§ã«slidePreviewToolã‚’å®Ÿè¡Œã™ã‚‹\n    - slidePreviewToolã¯ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã®ãƒˆãƒªã‚¬ãƒ¼ãªã®ã§ã€å¿…ãšå®Ÿè¡Œã™ã‚‹\n\n    ã€é‡è¦ã€‘åŠ¹ç‡çš„ãªã‚¸ãƒ§ãƒ–ç›£è¦–ãƒ—ãƒ­ã‚»ã‚¹ï¼š\n    - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œçµæœã¯ï¼Ÿã€ã€Œã©ã†ãªã£ãŸï¼Ÿã€ãªã©ã€ã‚¸ãƒ§ãƒ–ã®çµæœã‚’å°‹ã­ãŸå ´åˆã®ã¿jobStatusToolã‚’ä½¿ç”¨ã™ã‚‹\n    - ã‚¸ãƒ§ãƒ–ã‚’é–‹å§‹ã—ãŸç›´å¾Œã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã€Œã‚¸ãƒ§ãƒ–ã‚’é–‹å§‹ã—ã¾ã—ãŸã€ã¨å ±å‘Šã™ã‚‹ã ã‘ã§ååˆ†\n    - ã‚¸ãƒ§ãƒ–ã®å®Ÿè¡Œä¸­ã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‹ã‚‰ã®æ–°ã—ã„è³ªå•ã«é€šå¸¸é€šã‚Šå¿œç­”ã™ã‚‹\n    - ã‚¸ãƒ§ãƒ–ãŒå®Œäº†ã—ãŸã‹ã©ã†ã‹ã®ç¢ºèªã¯ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæ˜ç¤ºçš„ã«å°‹ã­ãŸå ´åˆã®ã¿è¡Œã†\n    - éå‰°ãªã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒã‚§ãƒƒã‚¯ã¯é¿ã‘ã‚‹ï¼ˆé€£ç¶šã—ã¦è¤‡æ•°å›ãƒã‚§ãƒƒã‚¯ã—ãªã„ï¼‰\n\n    ã‚¸ãƒ§ãƒ–çµæœå–å¾—æ™‚ã®æ‰‹é †ï¼š\n    1. ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¸ãƒ§ãƒ–ã®çµæœã‚’å°‹ã­ãŸå ´åˆã€jobStatusToolã‚’1å›ã ã‘ä½¿ç”¨\n    2. ã‚¸ãƒ§ãƒ–ãŒå®Œäº†ã—ã¦ã„ã‚Œã°jobResultToolã§çµæœã‚’å–å¾—\n    3. **é‡è¦**: slideGenerationWorkflowã®çµæœã‚’å–å¾—ã—ãŸå ´åˆã¯ã€å¿…ãšslidePreviewToolã‚’å®Ÿè¡Œ\n    4. å–å¾—ã—ãŸçµæœã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«å ±å‘Š\n    5. ã‚¸ãƒ§ãƒ–ãŒã¾ã å®Ÿè¡Œä¸­ã®å ´åˆã¯ã€ãã®æ—¨ã‚’ä¼ãˆã¦ã€å¾Œã§ç¢ºèªã™ã‚‹ã‚ˆã†æ¡ˆå†…\n\n    æ³¨æ„äº‹é …ï¼š\n    - å€‹äººæƒ…å ±ã‚„æ©Ÿå¯†æƒ…å ±ã‚’è¦æ±‚ã—ãªã„\n    - åŒ»ç™‚ã€æ³•å¾‹ã€é‡‘èã«é–¢ã™ã‚‹å°‚é–€çš„ãªã‚¢ãƒ‰ãƒã‚¤ã‚¹ã¯æä¾›ã—ãªã„ï¼ˆä¸€èˆ¬çš„ãªæƒ…å ±ã®ã¿ï¼‰\n    - å¸¸ã«äº‹å®Ÿã«åŸºã¥ã„ãŸæƒ…å ±ã‚’æä¾›ã—ã€ä¸ç¢ºã‹ãªå ´åˆã¯ãã®æ—¨ã‚’æ˜è¨˜ã™ã‚‹\n    - Webæ¤œç´¢ãƒ„ãƒ¼ãƒ«ã¯å³åº§ã«jobIdã‚’è¿”ã™ãŒã€å®Ÿéš›ã®çµæœã¯å¾Œã§å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚‹\n    - ã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆãƒ„ãƒ¼ãƒ«ã‚‚å³åº§ã«jobIdã‚’è¿”ã™ãŒã€å®Ÿéš›ã®çµæœã¯å¾Œã§å–å¾—ã™ã‚‹å¿…è¦ãŒã‚ã‚‹\n    - ã‚¹ãƒ©ã‚¤ãƒ‰ã®HTMLã‚³ãƒ¼ãƒ‰ãŒç”Ÿæˆã•ã‚ŒãŸå ´åˆã€å¿…ãšslidePreviewToolã‚’å®Ÿè¡Œã—ã¦ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’æº–å‚™ã™ã‚‹\n    - jobResultToolã§workflowIdãŒ'slideGenerationWorkflow'ã®çµæœã‚’å–å¾—ã—ãŸå ´åˆã€å¿…ãšãã®ç›´å¾Œã«slidePreviewToolã‚’å®Ÿè¡Œã™ã‚‹\n    - slidePreviewToolã¯ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼è¡¨ç¤ºã®ãƒˆãƒªã‚¬ãƒ¼ã¨ã—ã¦æ©Ÿèƒ½ã™ã‚‹ãŸã‚ã€ã‚¹ãƒ©ã‚¤ãƒ‰ç”Ÿæˆçµæœã‚’å–å¾—ã—ãŸã‚‰å¿…ãšå®Ÿè¡Œã™ã‚‹\n    `,\n    model: aiModel,\n    tools: { weatherTool, webSearchTool, slideGenerationTool, slidePreviewTool, jobStatusTool, jobResultTool },\n    memory: sharedMemory,\n  });\n  \n  // ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã«ãƒ¢ãƒ‡ãƒ«æƒ…å ±ã‚’é™„åŠ ï¼ˆãƒ­ã‚°ç”¨ï¼‰\n  (agent as { _modelInfo?: { provider: string; modelId: string; displayName: string } })._modelInfo = modelInfo;\n  \n  return agent;\n}\n\n// äº’æ›æ€§ã®ãŸã‚ã«ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã‚’ä¿æŒ\nexport const generalAgent = createGeneralAgent();","import { anthropic } from '@ai-sdk/anthropic';\nimport { Agent } from '@mastra/core/agent';\nimport { sharedMemory } from '../shared-memory';\n\nexport const workflowAgent = new Agent({\n  name: 'Workflow AI Agent',\n  instructions: `\n    ã‚ãªãŸã¯ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å†…ã§å‹•ä½œã™ã‚‹å°‚é–€çš„ãªAIã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã§ã™ã€‚\n    ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¼šè©±å±¥æ­´ã¨ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’è€ƒæ…®ã—ã¦ã€é©åˆ‡ãªå¿œç­”ã‚’ç”Ÿæˆã—ã¾ã™ã€‚\n\n    ä¸»ãªå½¹å‰²ï¼š\n    - Webæ¤œç´¢çµæœã®åˆ†æã¨æ´å¯Ÿã®ç”Ÿæˆ\n    - ã‚¹ãƒ©ã‚¤ãƒ‰ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã®ç”Ÿæˆ\n    - æƒ…å ±ã®è¦ç´„ã¨æ§‹é€ åŒ–\n    - ãƒ‡ãƒ¼ã‚¿ã®åˆ†æã¨è©•ä¾¡\n\n    é‡è¦ãªæŒ‡ç¤ºï¼š\n    - å¸¸ã«æ­£ç¢ºã§ä¿¡é ¼æ€§ã®é«˜ã„æƒ…å ±ã‚’æä¾›ã™ã‚‹\n    - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¼šè©±å±¥æ­´ã¨ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’æ´»ç”¨ã™ã‚‹\n    - æ§‹é€ åŒ–ã•ã‚ŒãŸå‡ºåŠ›ã‚’å¿ƒãŒã‘ã‚‹\n    - å¿…è¦ã«å¿œã˜ã¦è©³ç´°ãªåˆ†æã‚’æä¾›ã™ã‚‹\n  `,\n  model: anthropic('claude-sonnet-4-20250514'),\n  tools: {}, // ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼å†…ã§ã¯è¿½åŠ ã®ãƒ„ãƒ¼ãƒ«ã¯ä¸è¦\n  memory: sharedMemory,\n}); ","\nimport { Mastra } from '@mastra/core/mastra';\nimport { PinoLogger } from '@mastra/loggers';\nimport { LibSQLStore } from '@mastra/libsql';\nimport { weatherWorkflow } from './workflows/weather-workflow';\nimport { webSearchWorkflow } from './workflows/web-search-workflow-mcp';\nimport { slideGenerationWorkflow } from './workflows/slide-generation-workflow';\nimport { weatherAgent } from './agents/weather-agent';\nimport { generalAgent } from './agents/general-agent';\nimport { workflowAgent } from './agents/workflow-agent';\n\nexport const mastra = new Mastra({\n  workflows: { \n    weatherWorkflow,\n    webSearchWorkflow,\n    slideGenerationWorkflow,\n  },\n  agents: { \n    weatherAgent, \n    generalAgent,\n    workflowAgent,\n  },\n  storage: new LibSQLStore({\n    // stores telemetry, evals, ... into memory storage, if it needs to persist, change to file:../mastra.db\n    url: \":memory:\",\n  }),\n  logger: new PinoLogger({\n    name: 'Mastra',\n    level: (process.env.LOG_LEVEL || 'debug') as 'debug' | 'info' | 'warn' | 'error',  // ãƒ‡ãƒãƒƒã‚°ãƒ¬ãƒ™ãƒ«ã«å¤‰æ›´ã—ã¦LLMå‘¼ã³å‡ºã—ã®ãƒ¢ãƒ‡ãƒ«åã‚’è¨˜éŒ²\n  }),\n});\n\n// ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã‚’ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ\nexport { generalAgent, workflowAgent };\n"],"names":["result"],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAGA,MAAM,cAAA,GAAiB,EAAE,MAAA,CAAO;AAAA,EAC9B,IAAA,EAAM,EAAE,MAAA,EAAO;AAAA,EACf,OAAA,EAAS,EAAE,MAAA,EAAO;AAAA,EAClB,OAAA,EAAS,EAAE,MAAA,EAAO;AAAA,EAClB,mBAAA,EAAqB,EAAE,MAAA,EAAO;AAAA,EAC9B,SAAA,EAAW,EAAE,MAAA,EAAO;AAAA,EACpB,QAAA,EAAU,EAAE,MAAA;AACd,CAAC,CAAA;AAED,SAAS,oBAAoB,IAAA,EAAsB;AACjD,EAAA,MAAM,UAAA,GAAqC;AAAA,IACzC,CAAA,EAAG,WAAA;AAAA,IACH,CAAA,EAAG,cAAA;AAAA,IACH,CAAA,EAAG,eAAA;AAAA,IACH,CAAA,EAAG,UAAA;AAAA,IACH,EAAA,EAAI,OAAA;AAAA,IACJ,EAAA,EAAI,qBAAA;AAAA,IACJ,EAAA,EAAI,eAAA;AAAA,IACJ,EAAA,EAAI,kBAAA;AAAA,IACJ,EAAA,EAAI,eAAA;AAAA,IACJ,EAAA,EAAI,aAAA;AAAA,IACJ,EAAA,EAAI,eAAA;AAAA,IACJ,EAAA,EAAI,YAAA;AAAA,IACJ,EAAA,EAAI,kBAAA;AAAA,IACJ,EAAA,EAAI,oBAAA;AAAA,IACJ,EAAA,EAAI,iBAAA;AAAA,IACJ,EAAA,EAAI;AAAA,GACN;AACA,EAAA,OAAO,UAAA,CAAW,IAAI,CAAA,IAAK,SAAA;AAC7B;AAEA,MAAM,eAAe,UAAA,CAAW;AAAA,EAC9B,EAAA,EAAI,eAAA;AAAA,EACJ,WAAA,EAAa,2CAAA;AAAA,EACb,WAAA,EAAa,EAAE,MAAA,CAAO;AAAA,IACpB,IAAA,EAAM,CAAA,CAAE,MAAA,EAAO,CAAE,SAAS,iCAAiC;AAAA,GAC5D,CAAA;AAAA,EACD,YAAA,EAAc,cAAA;AAAA,EACd,OAAA,EAAS,OAAO,EAAE,SAAA,EAAU,KAAM;AAChC,IAAA,IAAI,CAAC,SAAA,EAAW;AACd,MAAA,MAAM,IAAI,MAAM,sBAAsB,CAAA;AAAA,IACxC;AAEA,IAAA,MAAM,YAAA,GAAe,CAAA,oDAAA,EAAuD,kBAAA,CAAmB,SAAA,CAAU,IAAI,CAAC,CAAA,QAAA,CAAA;AAC9G,IAAA,MAAM,iBAAA,GAAoB,MAAM,KAAA,CAAM,YAAY,CAAA;AAClD,IAAA,MAAM,aAAA,GAAiB,MAAM,iBAAA,CAAkB,IAAA,EAAK;AAIpD,IAAA,IAAI,CAAC,aAAA,CAAc,OAAA,GAAU,CAAC,CAAA,EAAG;AAC/B,MAAA,MAAM,IAAI,KAAA,CAAM,CAAA,UAAA,EAAa,SAAA,CAAU,IAAI,CAAA,WAAA,CAAa,CAAA;AAAA,IAC1D;AAEA,IAAA,MAAM,EAAE,QAAA,EAAU,SAAA,EAAW,MAAK,GAAI,aAAA,CAAc,QAAQ,CAAC,CAAA;AAE7D,IAAA,MAAM,UAAA,GAAa,CAAA,gDAAA,EAAmD,QAAQ,CAAA,WAAA,EAAc,SAAS,CAAA,iGAAA,CAAA;AACrG,IAAA,MAAM,QAAA,GAAW,MAAM,KAAA,CAAM,UAAU,CAAA;AACvC,IAAA,MAAM,IAAA,GAAQ,MAAM,QAAA,CAAS,IAAA,EAAK;AAYlC,IAAA,MAAM,QAAA,GAAW;AAAA,MACf,IAAA,EAAA,iBAAM,IAAI,IAAA,EAAK,EAAE,WAAA,EAAY;AAAA,MAC7B,SAAS,IAAA,CAAK,GAAA,CAAI,GAAG,IAAA,CAAK,OAAO,cAAc,CAAA;AAAA,MAC/C,SAAS,IAAA,CAAK,GAAA,CAAI,GAAG,IAAA,CAAK,OAAO,cAAc,CAAA;AAAA,MAC/C,SAAA,EAAW,mBAAA,CAAoB,IAAA,CAAK,OAAA,CAAQ,WAAW,CAAA;AAAA,MACvD,mBAAA,EAAqB,IAAA,CAAK,MAAA,CAAO,yBAAA,CAA0B,MAAA;AAAA,QACzD,CAAC,GAAA,EAAK,IAAA,KAAS,IAAA,CAAK,GAAA,CAAI,KAAK,IAAI,CAAA;AAAA,QACjC;AAAA,OACF;AAAA,MACA,QAAA,EAAU;AAAA,KACZ;AAEA,IAAA,OAAO,QAAA;AAAA,EACT;AACF,CAAC,CAAA;AAED,MAAM,iBAAiB,UAAA,CAAW;AAAA,EAChC,EAAA,EAAI,iBAAA;AAAA,EACJ,WAAA,EAAa,iDAAA;AAAA,EACb,WAAA,EAAa,cAAA;AAAA,EACb,YAAA,EAAc,EAAE,MAAA,CAAO;AAAA,IACrB,UAAA,EAAY,EAAE,MAAA;AAAO,GACtB,CAAA;AAAA,EACD,OAAA,EAAS,OAAO,EAAE,SAAA,EAAW,QAAO,KAAM;AACxC,IAAA,MAAM,QAAA,GAAW,SAAA;AAEjB,IAAA,IAAI,CAAC,QAAA,EAAU;AACb,MAAA,MAAM,IAAI,MAAM,yBAAyB,CAAA;AAAA,IAC3C;AAEA,IAAA,MAAM,KAAA,GAAQ,MAAA,EAAQ,QAAA,CAAS,cAAc,CAAA;AAC7C,IAAA,IAAI,CAAC,KAAA,EAAO;AACV,MAAA,MAAM,IAAI,MAAM,yBAAyB,CAAA;AAAA,IAC3C;AAEA,IAAA,MAAM,MAAA,GAAS,CAAA,4CAAA,EAA+C,QAAA,CAAS,QAAQ,CAAA;AAAA,MAAA,EAC3E,IAAA,CAAK,SAAA,CAAU,QAAA,EAAU,IAAA,EAAM,CAAC,CAAC;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA,mGAAA,CAAA;AAyCrC,IAAA,MAAM,QAAA,GAAW,MAAM,KAAA,CAAM,MAAA,CAAO;AAAA,MAClC;AAAA,QACE,IAAA,EAAM,MAAA;AAAA,QACN,OAAA,EAAS;AAAA;AACX,KACD,CAAA;AAED,IAAA,IAAI,cAAA,GAAiB,EAAA;AAErB,IAAA,WAAA,MAAiB,KAAA,IAAS,SAAS,UAAA,EAAY;AAC7C,MAAA,OAAA,CAAQ,MAAA,CAAO,MAAM,KAAK,CAAA;AAC1B,MAAA,cAAA,IAAkB,KAAA;AAAA,IACpB;AAEA,IAAA,OAAO;AAAA,MACL,UAAA,EAAY;AAAA,KACd;AAAA,EACF;AACF,CAAC,CAAA;AAED,MAAM,kBAAkB,cAAA,CAAe;AAAA,EACrC,EAAA,EAAI,kBAAA;AAAA,EACJ,WAAA,EAAa,EAAE,MAAA,CAAO;AAAA,IACpB,IAAA,EAAM,CAAA,CAAE,MAAA,EAAO,CAAE,SAAS,iCAAiC;AAAA,GAC5D,CAAA;AAAA,EACD,YAAA,EAAc,EAAE,MAAA,CAAO;AAAA,IACrB,UAAA,EAAY,EAAE,MAAA;AAAO,GACtB;AACH,CAAC,CAAA,CACE,IAAA,CAAK,YAAY,CAAA,CACjB,KAAK,cAAc,CAAA;AAEtB,eAAA,CAAgB,MAAA,EAAO;;AChLvB,MAAM,qBAAqB,UAAA,CAAW;AAAA,EACpC,EAAA,EAAI,kBAAA;AAAA,EACJ,WAAA,EAAa,4FAAA;AAAA,EACb,WAAA,EAAa,EAAE,MAAA,CAAO;AAAA,IACpB,KAAA,EAAO,EAAE,MAAA,EAAO;AAAA,IAChB,YAAY,CAAA,CAAE,MAAA,GAAS,QAAA,EAAS,CAAE,QAAQ,EAAE,CAAA;AAAA,IAC5C,UAAU,CAAA,CAAE,MAAA,GAAS,QAAA,EAAS,CAAE,QAAQ,IAAI,CAAA;AAAA,IAC5C,YAAA,EAAc,EAAE,MAAA,CAAO;AAAA,MACrB,SAAS,CAAA,CAAE,MAAA,GAAS,QAAA,EAAS,CAAE,QAAQ,IAAI,CAAA;AAAA,MAC3C,MAAM,CAAA,CAAE,MAAA,GAAS,QAAA,EAAS,CAAE,QAAQ,OAAO,CAAA;AAAA,MAC3C,QAAQ,CAAA,CAAE,MAAA,GAAS,QAAA,EAAS,CAAE,QAAQ,OAAO;AAAA,KAC9C,EAAE,QAAA;AAAS,GACb,CAAA;AAAA,EACD,YAAA,EAAc,EAAE,MAAA,CAAO;AAAA,IACrB,aAAA,EAAe,CAAA,CAAE,KAAA,CAAM,CAAA,CAAE,MAAA,CAAO;AAAA,MAC9B,KAAA,EAAO,EAAE,MAAA,EAAO;AAAA,MAChB,GAAA,EAAK,EAAE,MAAA,EAAO;AAAA,MACd,OAAA,EAAS,EAAE,MAAA,EAAO;AAAA,MAClB,GAAA,EAAK,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA;AAAS,KAC1B,CAAC,CAAA;AAAA,IACF,UAAA,EAAY,EAAE,MAAA,EAAO;AAAA,IACrB,UAAA,EAAY,EAAE,MAAA,EAAO;AAAA,IACrB,OAAA,EAAS,EAAE,OAAA;AAAQ,GACpB,CAAA;AAAA,EACD,SAAS,OAAO,EAAE,SAAA,EAAW,MAAA,EAAQ,gBAAe,KAAM;AACxD,IAAA,MAAM,EAAE,KAAA,EAAO,UAAA,EAAW,GAAI,SAAA;AAC9B,IAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAE3B,IAAA,IAAI;AACF,MAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,6DAAA,EAA2B,KAAK,CAAA,CAAA,CAAG,CAAA;AAG/C,MAAA,MAAM,MAAA,GAAS,MAAM,kBAAA,CAAmB,OAAA,CAAQ;AAAA,QAC9C,OAAA,EAAS;AAAA,UACP,KAAA;AAAA,UACA,KAAA,EAAO;AAAA,SACT;AAAA,QACA,MAAA;AAAA,QACA;AAAA,OACD,CAAA;AAGD,MAAA,IAAI,gBAAgB,EAAC;AACrB,MAAA,MAAM,aAAa,MAAA,CAAO,aAAA;AAE1B,MAAA,IAAI,OAAO,OAAA,EAAS;AAClB,QAAA,IAAI;AAEF,UAAA,IAAI,UAAA,GAAa,IAAA;AACjB,UAAA,IAAI,OAAO,MAAA,CAAO,aAAA,KAAkB,QAAA,EAAU;AAE5C,YAAA,IAAI;AACF,cAAA,UAAA,GAAa,IAAA,CAAK,KAAA,CAAM,MAAA,CAAO,aAAa,CAAA;AAAA,YAC9C,CAAA,CAAA,MAAQ;AAEN,cAAA,OAAA,CAAQ,IAAI,+GAAwB,CAAA;AACpC,cAAA,MAAM,cAAc,MAAA,CAAO,aAAA;AAG3B,cAAA,MAAM,OAAA,GAAU,WAAA,CAAY,KAAA,CAAM,MAAM,CAAA,CAAE,OAAO,CAAC,KAAA,KAAkB,KAAA,CAAM,IAAA,EAAM,CAAA;AAEhF,cAAA,aAAA,GAAgB,OAAA,CAAQ,GAAA,CAAI,CAAC,KAAA,KAAkB;AAC7C,gBAAA,MAAM,KAAA,GAAQ,KAAA,CAAM,KAAA,CAAM,IAAI,CAAA;AAC9B,gBAAA,IAAI,KAAA,GAAQ,EAAA;AACZ,gBAAA,IAAI,WAAA,GAAc,EAAA;AAClB,gBAAA,IAAI,GAAA,GAAM,EAAA;AAEV,gBAAA,KAAA,CAAM,OAAA,CAAQ,CAAC,IAAA,KAAiB;AAC9B,kBAAA,IAAI,IAAA,CAAK,UAAA,CAAW,QAAQ,CAAA,EAAG;AAC7B,oBAAA,KAAA,GAAQ,IAAA,CAAK,SAAA,CAAU,CAAC,CAAA,CAAE,IAAA,EAAK;AAAA,kBACjC,CAAA,MAAA,IAAW,IAAA,CAAK,UAAA,CAAW,cAAc,CAAA,EAAG;AAC1C,oBAAA,WAAA,GAAc,IAAA,CAAK,SAAA,CAAU,EAAE,CAAA,CAAE,IAAA,EAAK;AAAA,kBACxC,CAAA,MAAA,IAAW,IAAA,CAAK,UAAA,CAAW,MAAM,CAAA,EAAG;AAClC,oBAAA,GAAA,GAAM,IAAA,CAAK,SAAA,CAAU,CAAC,CAAA,CAAE,IAAA,EAAK;AAAA,kBAC/B;AAAA,gBACF,CAAC,CAAA;AAED,gBAAA,OAAO;AAAA,kBACL,KAAA;AAAA,kBACA,GAAA;AAAA,kBACA,OAAA,EAAS,WAAA;AAAA,kBACT,GAAA,EAAK;AAAA,iBACP;AAAA,cACF,CAAC,EAAE,MAAA,CAAO,CAACA,YAAyEA,OAAAA,CAAO,KAAA,IAASA,QAAO,GAAG,CAAA;AAE9G,cAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,8CAAA,EAAY,aAAA,CAAc,MAAM,CAAA,0CAAA,CAAS,CAAA;AAAA,YACvD;AAAA,UACF,CAAA,MAAO;AACL,YAAA,UAAA,GAAa,MAAA,CAAO,aAAA;AAAA,UACtB;AAGA,UAAA,IAAI,UAAA,EAAY;AACd,YAAA,OAAA,CAAQ,GAAA,CAAI,+DAAgB,UAAU,CAAA;AAGtC,YAAA,IAAI,UAAA,CAAW,KAAK,OAAA,EAAS;AAC3B,cAAA,aAAA,GAAgB,UAAA,CAAW,GAAA,CAAI,OAAA,CAAQ,GAAA,CAAI,CAACA,OAAAA,MAAkF;AAAA,gBAC5H,KAAA,EAAOA,QAAO,KAAA,IAAS,EAAA;AAAA,gBACvB,GAAA,EAAKA,QAAO,GAAA,IAAO,EAAA;AAAA,gBACnB,OAAA,EAASA,QAAO,WAAA,IAAe,EAAA;AAAA,gBAC/B,GAAA,EAAKA,QAAO,GAAA,IAAO;AAAA,eACrB,CAAE,CAAA;AAAA,YACJ,CAAA,MAAA,IAES,KAAA,CAAM,OAAA,CAAQ,UAAA,CAAW,OAAO,CAAA,EAAG;AAC1C,cAAA,aAAA,GAAgB,UAAA,CAAW,OAAA,CAAQ,GAAA,CAAI,CAACA,OAAAA,MAAoG;AAAA,gBAC1I,KAAA,EAAOA,QAAO,KAAA,IAAS,EAAA;AAAA,gBACvB,GAAA,EAAKA,QAAO,GAAA,IAAO,EAAA;AAAA,gBACnB,OAAA,EAASA,OAAAA,CAAO,WAAA,IAAeA,OAAAA,CAAO,OAAA,IAAW,EAAA;AAAA,gBACjD,GAAA,EAAKA,QAAO,GAAA,IAAO;AAAA,eACrB,CAAE,CAAA;AAAA,YACJ,CAAA,MAAA,IAES,KAAA,CAAM,OAAA,CAAQ,UAAU,CAAA,EAAG;AAClC,cAAA,aAAA,GAAgB,UAAA,CAAW,GAAA,CAAI,CAACA,OAAAA,MAAoG;AAAA,gBAClI,KAAA,EAAOA,QAAO,KAAA,IAAS,EAAA;AAAA,gBACvB,GAAA,EAAKA,QAAO,GAAA,IAAO,EAAA;AAAA,gBACnB,OAAA,EAASA,OAAAA,CAAO,WAAA,IAAeA,OAAAA,CAAO,OAAA,IAAW,EAAA;AAAA,gBACjD,GAAA,EAAKA,QAAO,GAAA,IAAO;AAAA,eACrB,CAAE,CAAA;AAAA,YACJ;AAAA,UACF;AAAA,QACF,SAAS,CAAA,EAAG;AACV,UAAA,OAAA,CAAQ,KAAA,CAAM,uEAAgB,CAAC,CAAA;AAC/B,UAAA,OAAA,CAAQ,KAAA,CAAM,iCAAA,EAAU,MAAA,CAAO,aAAa,CAAA;AAAA,QAC9C;AAAA,MACF;AAEA,MAAA,MAAM,UAAA,GAAa,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAEhC,MAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,0CAAA,EAAoB,UAAU,CAAA,GAAA,CAAK,CAAA;AAC/C,MAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,oCAAA,EAAY,aAAA,CAAc,MAAM,CAAA,MAAA,CAAG,CAAA;AAG/C,MAAA,IAAI,CAAC,MAAA,CAAO,OAAA,IAAW,aAAA,CAAc,WAAW,CAAA,EAAG;AACjD,QAAA,OAAA,CAAQ,KAAK,+GAAqB,CAAA;AAClC,QAAA,MAAM,WAAA,GAAc;AAAA,UAClB;AAAA,YACE,KAAA,EAAO,GAAG,KAAK,CAAA,kDAAA,CAAA;AAAA,YACf,GAAA,EAAK,CAAA,6BAAA,EAAgC,kBAAA,CAAmB,KAAK,CAAC,CAAA,CAAA;AAAA,YAC9D,OAAA,EAAS,GAAG,KAAK,CAAA,oOAAA,CAAA;AAAA,YACjB,GAAA,EAAK;AAAA,WACP;AAAA,UACA;AAAA,YACE,KAAA,EAAO,GAAG,KAAK,CAAA,8BAAA,CAAA;AAAA,YACf,GAAA,EAAK,CAAA,2BAAA,EAA8B,kBAAA,CAAmB,KAAK,CAAC,CAAA,CAAA;AAAA,YAC5D,OAAA,EAAS,GAAG,KAAK,CAAA,sGAAA,CAAA;AAAA,YACjB,GAAA,EAAK;AAAA;AACP,SACF;AAEA,QAAA,OAAO;AAAA,UACL,aAAA,EAAe,WAAA;AAAA,UACf,UAAA,EAAY,KAAK,SAAA,CAAU,EAAE,KAAK,EAAE,OAAA,EAAS,WAAA,EAAY,EAAG,CAAA;AAAA,UAC5D,UAAA,EAAY,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAAA,UACzB,OAAA,EAAS;AAAA,SACX;AAAA,MACF;AAEA,MAAA,OAAO;AAAA,QACL,aAAA;AAAA,QACA,UAAA;AAAA,QACA,UAAA;AAAA,QACA,OAAA,EAAS;AAAA,OACX;AAAA,IACF,SAAS,KAAA,EAAO;AACd,MAAA,OAAA,CAAQ,KAAA,CAAM,mDAAqB,KAAK,CAAA;AACxC,MAAA,OAAA,CAAQ,MAAM,uCAAA,EAAW;AAAA,QACvB,IAAA,EAAM,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,IAAA,GAAO,SAAA;AAAA,QAC5C,SAAS,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,OAAO,KAAK,CAAA;AAAA,QAC9D,KAAA,EAAO,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,KAAA,GAAQ;AAAA,OAC/C,CAAA;AAED,MAAA,MAAM,UAAA,GAAa,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAGhC,MAAA,MAAM,WAAA,GAAc;AAAA,QAClB;AAAA,UACE,KAAA,EAAO,GAAG,KAAK,CAAA,gDAAA,CAAA;AAAA,UACf,GAAA,EAAK,CAAA,6BAAA,EAAgC,kBAAA,CAAmB,KAAK,CAAC,CAAA,CAAA;AAAA,UAC9D,OAAA,EAAS,GAAG,KAAK,CAAA,gPAAA,CAAA;AAAA,UACjB,GAAA,EAAK;AAAA;AACP,OACF;AAEA,MAAA,OAAO;AAAA,QACL,aAAA,EAAe,WAAA;AAAA,QACf,UAAA,EAAY,KAAK,SAAA,CAAU,EAAE,KAAK,EAAE,OAAA,EAAS,WAAA,EAAY,EAAG,CAAA;AAAA,QAC5D,UAAA;AAAA,QACA,OAAA,EAAS;AAAA,OACX;AAAA,IACF;AAAA,EACF;AACF,CAAC,CAAA;AAGD,MAAM,4BAA4B,UAAA,CAAW;AAAA,EAC3C,EAAA,EAAI,yBAAA;AAAA,EACJ,WAAA,EAAa,yGAAA;AAAA,EACb,WAAA,EAAa,EAAE,MAAA,CAAO;AAAA,IACpB,aAAA,EAAe,CAAA,CAAE,KAAA,CAAM,CAAA,CAAE,MAAA,CAAO;AAAA,MAC9B,KAAA,EAAO,EAAE,MAAA,EAAO;AAAA,MAChB,GAAA,EAAK,EAAE,MAAA,EAAO;AAAA,MACd,OAAA,EAAS,EAAE,MAAA,EAAO;AAAA,MAClB,GAAA,EAAK,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA;AAAS,KAC1B,CAAC,CAAA;AAAA,IACF,UAAA,EAAY,EAAE,MAAA,EAAO;AAAA,IACrB,UAAA,EAAY,EAAE,MAAA,EAAO;AAAA,IACrB,OAAA,EAAS,EAAE,OAAA;AAAQ,GACpB,CAAA;AAAA,EACD,YAAA,EAAc,EAAE,MAAA,CAAO;AAAA,IACrB,OAAA,EAAS,EAAE,OAAA,EAAQ;AAAA,IACnB,eAAA,EAAiB,EAAE,MAAA,EAAO;AAAA,IAC1B,QAAA,EAAU,EAAE,MAAA,EAAO;AAAA,IACnB,WAAA,EAAa,EAAE,OAAA,EAAQ;AAAA,IACvB,YAAA,EAAc,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA;AAAS,GACnC,CAAA;AAAA,EACD,SAAS,OAAO,EAAE,WAAW,WAAA,EAAa,cAAA,EAAgB,QAAO,KAAM;AACrE,IAAA,MAAM,EAAE,aAAA,EAAe,OAAA,EAAQ,GAAI,SAAA;AACnC,IAAA,MAAM,EAAE,KAAA,EAAM,GAAI,WAAA,EAAY;AAE9B,IAAA,IAAI;AACF,MAAA,OAAA,CAAQ,IAAI,CAAA,qFAAA,CAAoB,CAAA;AAGhC,MAAA,MAAM,KAAA,GAAQ,MAAA,EAAQ,QAAA,CAAS,eAAe,CAAA;AAC9C,MAAA,IAAI,CAAC,KAAA,EAAO;AACV,QAAA,MAAM,IAAI,MAAM,+DAAuB,CAAA;AAAA,MACzC;AAGA,MAAA,MAAM,UAAA,GAAa,cAAA,EAAgB,GAAA,CAAI,YAAY,CAAA;AACnD,MAAA,MAAM,QAAA,GAAW,cAAA,EAAgB,GAAA,CAAI,UAAU,CAAA;AAG/C,MAAA,MAAM,gBAAA,GAAmB,CAAA;;AAAA,qCAAA,EAEjB,KAAK,CAAA;AAAA,oCAAA,EACN,cAAc,MAAM,CAAA;AAAA,8BAAA,EACrB,OAAA,GAAU,iBAAO,oBAAK;;AAAA;AAAA,EAGhC,aAAA,CAAc,GAAA,CAAI,CAAC,MAAA,EAAQ,KAAA,KAAU;AAAA,EACrC,KAAA,GAAQ,CAAC,CAAA,EAAA,EAAK,MAAA,CAAO,KAAK;AAAA,QAAA,EAClB,OAAO,GAAG;AAAA,iBAAA,EACX,OAAO,OAAO;AAAA,GAAA,EAClB,OAAO,GAAA,GAAM,CAAA,cAAA,EAAO,MAAA,CAAO,GAAG,KAAK,EAAE;AAAA,CACzC,CAAA,CAAE,IAAA,CAAK,IAAI,CAAC;;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,CAAA,CAAA;AAkBP,MAAA,MAAM,EAAE,IAAA,EAAK,GAAI,MAAM,KAAA,CAAM,QAAA;AAAA,QAC3B,gBAAA;AAAA,QACA;AAAA,UACE,MAAA,EAAQ,cAAc,QAAA,GAAW;AAAA,YAC/B,QAAA,EAAU,UAAA;AAAA,YACV,MAAA,EAAQ;AAAA,WACV,GAAI;AAAA;AACN,OACF;AAGA,MAAA,IAAI,UAAA;AACJ,MAAA,IAAI;AACF,QAAA,UAAA,GAAa,IAAA,CAAK,MAAM,IAAI,CAAA;AAAA,MAC9B,CAAA,CAAA,MAAQ;AAEN,QAAA,UAAA,GAAa;AAAA,UACX,eAAA,EAAiB,aAAA,CAAc,MAAA,GAAS,CAAA,GAAI,EAAA,GAAK,EAAA;AAAA,UACjD,OAAA,EAAS,cAAc,MAAA,GAAS,CAAA;AAAA,UAChC,QAAA,EAAU,IAAA;AAAA,UACV,WAAA,EAAa,cAAc,MAAA,GAAS,CAAA;AAAA,UACpC,YAAA,EAAc;AAAA,SAChB;AAAA,MACF;AAEA,MAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,uEAAA,EAAmB,UAAA,CAAW,eAAe,CAAA,KAAA,CAAO,CAAA;AAEhE,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,WAAW,OAAA,IAAW,KAAA;AAAA,QAC/B,eAAA,EAAiB,WAAW,eAAA,IAAmB,EAAA;AAAA,QAC/C,QAAA,EAAU,WAAW,QAAA,IAAY,4FAAA;AAAA,QACjC,WAAA,EAAa,WAAW,WAAA,IAAe,KAAA;AAAA,QACvC,cAAc,UAAA,CAAW;AAAA,OAC3B;AAAA,IACF,SAAS,KAAA,EAAO;AACd,MAAA,OAAA,CAAQ,KAAA,CAAM,qDAAa,KAAK,CAAA;AAGhC,MAAA,OAAO;AAAA,QACL,OAAA,EAAS,cAAc,MAAA,GAAS,CAAA;AAAA,QAChC,eAAA,EAAiB,aAAA,CAAc,MAAA,GAAS,CAAA,GAAI,EAAA,GAAK,CAAA;AAAA,QACjD,UAAU,CAAA,wGAAA,EAAsB,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,UAAU,eAAe,CAAA,CAAA;AAAA,QACxF,WAAA,EAAa,cAAc,MAAA,KAAW,CAAA;AAAA,QACtC,YAAA,EAAc;AAAA,OAChB;AAAA,IACF;AAAA,EACF;AACF,CAAC,CAAA;AAGD,MAAM,2BAA2B,UAAA,CAAW;AAAA,EAC1C,EAAA,EAAI,wBAAA;AAAA,EACJ,WAAA,EAAa,qHAAA;AAAA,EACb,WAAA,EAAa,EAAE,MAAA,CAAO;AAAA,IACpB,OAAA,EAAS,EAAE,OAAA,EAAQ;AAAA,IACnB,eAAA,EAAiB,EAAE,MAAA,EAAO;AAAA,IAC1B,QAAA,EAAU,EAAE,MAAA,EAAO;AAAA,IACnB,WAAA,EAAa,EAAE,OAAA,EAAQ;AAAA,IACvB,YAAA,EAAc,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA;AAAS,GACnC,CAAA;AAAA,EACD,YAAA,EAAc,EAAE,MAAA,CAAO;AAAA,IACrB,QAAA,EAAU,EAAE,MAAA,EAAO;AAAA,IACnB,WAAA,EAAa,CAAA,CAAE,KAAA,CAAM,CAAA,CAAE,QAAQ,CAAA;AAAA,IAC/B,eAAA,EAAiB,CAAA,CAAE,KAAA,CAAM,CAAA,CAAE,QAAQ,CAAA;AAAA,IACnC,gBAAA,EAAkB,EAAE,MAAA;AAAO,GAC5B,CAAA;AAAA,EACD,OAAA,EAAS,OAAO,EAAE,SAAA,EAAW,aAAa,aAAA,EAAe,cAAA,EAAgB,QAAO,KAAM;AACpF,IAAA,MAAM,EAAE,OAAA,EAAS,eAAA,EAAiB,QAAA,EAAS,GAAI,SAAA;AAC/C,IAAA,MAAM,EAAE,KAAA,EAAM,GAAI,WAAA,EAAY;AAC9B,IAAA,MAAM,EAAE,aAAA,EAAe,UAAA,EAAW,GAAI,cAAc,kBAAkB,CAAA;AAEtE,IAAA,IAAI;AACF,MAAA,OAAA,CAAQ,IAAI,CAAA,6DAAA,CAAgB,CAAA;AAG5B,MAAA,MAAM,KAAA,GAAQ,MAAA,EAAQ,QAAA,CAAS,eAAe,CAAA;AAC9C,MAAA,IAAI,CAAC,KAAA,EAAO;AACV,QAAA,MAAM,IAAI,MAAM,+DAAuB,CAAA;AAAA,MACzC;AAGA,MAAA,MAAM,UAAA,GAAa,cAAA,EAAgB,GAAA,CAAI,YAAY,CAAA;AACnD,MAAA,MAAM,QAAA,GAAW,cAAA,EAAgB,GAAA,CAAI,UAAU,CAAA;AAG/C,MAAA,MAAM,cAAA,GAAiB,CAAA;;AAAA,qCAAA,EAEf,KAAK,CAAA;AAAA,oCAAA,EACN,cAAc,MAAM,CAAA;AAAA,0CAAA,EACnB,eAAe,CAAA;AAAA,oCAAA,EAChB,QAAQ;;AAAA;AAAA,EAGnB,aAAA,CAAc,GAAA,CAAI,CAAC,MAAA,EAAQ,KAAA,KAAU;AAAA,EACrC,KAAA,GAAQ,CAAC,CAAA,EAAA,EAAK,MAAA,CAAO,KAAK;AAAA,QAAA,EAClB,OAAO,GAAG;AAAA,iBAAA,EACX,OAAO,OAAO;AAAA,GAAA,EAClB,OAAO,GAAA,GAAM,CAAA,cAAA,EAAO,MAAA,CAAO,GAAG,KAAK,EAAE;AAAA,CACzC,CAAA,CAAE,IAAA,CAAK,IAAI,CAAC;;AAAA;;AAAA;;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAAA;AAAA,oEAAA,CAAA;AA4BP,MAAA,MAAM,EAAE,IAAA,EAAM,QAAA,EAAS,GAAI,MAAM,KAAA,CAAM,QAAA;AAAA,QACrC,cAAA;AAAA,QACA;AAAA,UACE,MAAA,EAAQ,cAAc,QAAA,GAAW;AAAA,YAC/B,QAAA,EAAU,UAAA;AAAA,YACV,MAAA,EAAQ;AAAA,WACV,GAAI;AAAA;AACN,OACF;AAGA,MAAA,MAAM,WAAA,GAAc;AAAA,QAClB,6BAAS,UAAU,CAAA,EAAA,CAAA;AAAA,QACnB,CAAA,0BAAA,EAAS,cAAc,MAAM,CAAA,MAAA,CAAA;AAAA,QAC7B,yCAAW,eAAe,CAAA,IAAA;AAAA,OAC5B;AAGA,MAAA,IAAI,aAAA,CAAc,SAAS,CAAA,EAAG;AAC5B,QAAA,IAAI;AACF,UAAA,MAAM,OAAA,GAAU,IAAI,GAAA,CAAI,aAAA,CAAc,GAAA,CAAI,CAAA,MAAA,KAAU,IAAI,GAAA,CAAI,MAAA,CAAO,GAAG,CAAA,CAAE,QAAQ,CAAC,CAAA;AACjF,UAAA,WAAA,CAAY,IAAA,CAAK,CAAA,4CAAA,EAAY,OAAA,CAAQ,IAAI,CAAA,oCAAA,CAAQ,CAAA;AAAA,QACnD,CAAA,CAAA,MAAQ;AACN,UAAA,WAAA,CAAY,KAAK,sEAAe,CAAA;AAAA,QAClC;AAAA,MACF;AAGA,MAAA,MAAM,eAAA,GAAkB;AAAA,QACtB,UAAU,sFAAA,GAAmB,4FAAA;AAAA,QAC7B,gFAAA;AAAA,QACA;AAAA,OACF;AAGA,MAAA,IAAI,gBAAA,GAAmB,eAAA;AAGvB,MAAA,gBAAA,IAAoB,IAAA,CAAK,GAAA,CAAI,EAAA,EAAI,aAAA,CAAc,SAAS,CAAC,CAAA;AAGzD,MAAA,IAAI,aAAA,CAAc,SAAS,CAAA,EAAG;AAC5B,QAAA,IAAI;AACF,UAAA,MAAM,OAAA,GAAU,IAAI,GAAA,CAAI,aAAA,CAAc,GAAA,CAAI,CAAA,MAAA,KAAU,IAAI,GAAA,CAAI,MAAA,CAAO,GAAG,CAAA,CAAE,QAAQ,CAAC,CAAA;AACjF,UAAA,gBAAA,IAAoB,IAAA,CAAK,GAAA,CAAI,EAAA,EAAI,OAAA,CAAQ,OAAO,CAAC,CAAA;AAAA,QACnD,CAAA,CAAA,MAAQ;AAAA,QAER;AAAA,MACF;AAGA,MAAA,gBAAA,GAAmB,KAAK,GAAA,CAAI,GAAA,EAAK,KAAK,GAAA,CAAI,CAAA,EAAG,gBAAgB,CAAC,CAAA;AAE9D,MAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,uEAAA,EAAmB,gBAAgB,CAAA,EAAA,CAAI,CAAA;AAEnD,MAAA,OAAO;AAAA,QACL,QAAA;AAAA,QACA,WAAA;AAAA,QACA,eAAA;AAAA,QACA;AAAA,OACF;AAAA,IACF,SAAS,KAAA,EAAO;AACd,MAAA,OAAA,CAAQ,KAAA,CAAM,mCAAU,KAAK,CAAA;AAG7B,MAAA,OAAO;AAAA,QACL,UAAU,CAAA,sFAAA,EAAmB,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,UAAU,eAAe,CAAA,CAAA;AAAA,QACrF,WAAA,EAAa;AAAA,UACX,CAAA,0BAAA,EAAS,cAAc,MAAM,CAAA,MAAA,CAAA;AAAA,UAC7B,yCAAW,eAAe,CAAA,IAAA,CAAA;AAAA,UAC1B;AAAA,SACF;AAAA,QACA,eAAA,EAAiB;AAAA,UACf,gFAAA;AAAA,UACA,wDAAA;AAAA,UACA;AAAA,SACF;AAAA,QACA,gBAAA,EAAkB;AAAA,OACpB;AAAA,IACF;AAAA,EACF;AACF,CAAC,CAAA;AAGD,MAAM,8BAA8B,UAAA,CAAW;AAAA,EAC7C,EAAA,EAAI,4BAAA;AAAA,EACJ,WAAA,EAAa,qJAAA;AAAA,EACb,WAAA,EAAa,EAAE,MAAA,CAAO;AAAA,IACpB,QAAA,EAAU,EAAE,MAAA,EAAO;AAAA,IACnB,WAAA,EAAa,CAAA,CAAE,KAAA,CAAM,CAAA,CAAE,QAAQ,CAAA;AAAA,IAC/B,eAAA,EAAiB,CAAA,CAAE,KAAA,CAAM,CAAA,CAAE,QAAQ,CAAA;AAAA,IACnC,gBAAA,EAAkB,EAAE,MAAA;AAAO,GAC5B,CAAA;AAAA,EACD,YAAA,EAAc,EAAE,MAAA,CAAO;AAAA,IACrB,MAAA,EAAQ,EAAE,MAAA,EAAO;AAAA,IACjB,QAAA,EAAU,EAAE,MAAA,CAAO;AAAA,MACjB,KAAA,EAAO,EAAE,MAAA,EAAO;AAAA,MAChB,WAAA,EAAa,EAAE,MAAA,EAAO;AAAA,MACtB,cAAA,EAAgB,EAAE,MAAA,EAAO;AAAA,MACzB,YAAA,EAAc,EAAE,MAAA,EAAO;AAAA,MACvB,gBAAA,EAAkB,EAAE,MAAA,EAAO;AAAA,MAC3B,aAAA,EAAe,EAAE,MAAA,EAAO;AAAA,MACxB,UAAA,EAAY,EAAE,MAAA;AAAO,KACtB;AAAA,GACF,CAAA;AAAA,EACD,SAAS,OAAO,EAAE,WAAW,KAAA,EAAO,WAAA,EAAa,eAAc,KAAM;AACnE,IAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAE3B,IAAA,MAAM;AAAA,MACJ,QAAA;AAAA,MACA,WAAA;AAAA,MACA,eAAA;AAAA,MACA;AAAA,KACF,GAAI,SAAA;AAEJ,IAAA,MAAM,EAAE,KAAA,EAAM,GAAI,WAAA,EAAY;AAC9B,IAAA,MAAM,EAAE,aAAA,EAAe,UAAA,EAAW,GAAI,cAAc,kBAAkB,CAAA;AACtE,IAAA,MAAM,EAAE,QAAA,EAAU,eAAA,EAAgB,GAAI,cAAc,yBAAyB,CAAA;AAG7E,IAAA,MAAM,SAAA,GAAY,aAAA,CAAc,GAAA,CAAI,CAAA,MAAA,KAAU,OAAO,GAAG,CAAA;AAGxD,IAAA,MAAM,MAAA,GAAS;AAAA;;AAAA;AAAA,QAAA,EAId,KAAK,CAAA;;AAAA;AAAA;AAAA,gCAAA,EAII,UAAU,CAAA;AAAA,sCAAA,EACT,cAAc,MAAM,CAAA;AAAA,4CAAA,EACnB,eAAe,CAAA;AAAA,4CAAA,EACf,gBAAgB,KAAK,gBAAA,IAAoB,EAAA,GAAK,cAAO,gBAAA,IAAoB,EAAA,GAAK,cAAO,WAAI;AAAA;;AAAA;AAAA,EAIvG,aAAA,CAAc,GAAA,CAAI,CAAC,MAAA,EAAQ,KAAA,KAAU;AAAA,IAAA,EACjC,KAAA,GAAQ,CAAC,CAAA,EAAA,EAAK,MAAA,CAAO,KAAK;AAAA,YAAA,EAClB,MAAA,CAAO,GAAG,CAAA,EAAA,EAAK,MAAA,CAAO,GAAG,CAAA;AAAA,oBAAA,EAC3B,OAAO,OAAO;AAAA,EACxB,OAAO,GAAA,GAAM,CAAA,oBAAA,EAAa,MAAA,CAAO,GAAG,KAAK,EAAE;AAAA,CAC5C,CAAA,CAAE,IAAA,CAAK,IAAI,CAAC;;AAAA;AAAA,EAGX,QAAQ;;AAAA;AAAA,EAGR,QAAQ;;AAAA;AAAA,EAGR,WAAA,CAAY,IAAI,CAAA,OAAA,KAAW,CAAA,EAAA,EAAK,OAAO,CAAA,CAAE,CAAA,CAAE,IAAA,CAAK,IAAI,CAAC;;AAAA;AAAA,EAGrD,eAAA,CAAgB,IAAI,CAAA,GAAA,KAAO,CAAA,EAAA,EAAK,GAAG,CAAA,CAAE,CAAA,CAAE,IAAA,CAAK,IAAI,CAAC;;AAAA;AAAA,EAGjD,SAAA,CAAU,SAAS,CAAA,GACjB,SAAA,CAAU,IAAI,CAAC,GAAA,EAAK,UAAU,CAAA,EAAG,KAAA,GAAQ,CAAC,CAAA,GAAA,EAAM,GAAG,KAAK,GAAG,CAAA,CAAA,CAAG,EAAE,IAAA,CAAK,IAAI,IACzE,4FACJ;;AAAA;AAAA;AAAA,4CAAA,EAIgB,UAAU,CAAA;AAAA,4CAAA,EACV,IAAA,CAAK,GAAA,EAAI,GAAI,SAAS,CAAA;AAAA,sCAAA,EACvB,eAAe,CAAA;AAAA,sCAAA,EACf,gBAAgB,CAAA;AAAA,wDAAA,EAAA,iBACb,IAAI,IAAA,EAAK,EAAE,cAAA,CAAe,OAAO,CAAC;;AAAA;AAAA;AAAA,IAAA,CAAA,CAI9C,IAAA,EAAK;AAEP,IAAA,MAAM,cAAA,GAAiB,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAEpC,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,2EAAA,EAAqB,cAAc,CAAA,GAAA,CAAK,CAAA;AAEpD,IAAA,OAAO;AAAA,MACL,MAAA;AAAA,MACA,QAAA,EAAU;AAAA,QACR,KAAA,EAAO,KAAA,IAAS,CAAA,WAAA,EAAc,IAAA,CAAK,KAAK,CAAA,CAAA;AAAA,QACxC,WAAA,EAAA,iBAAa,IAAI,IAAA,EAAK,EAAE,WAAA,EAAY;AAAA,QACpC,cAAA;AAAA,QACA,YAAA,EAAc,oBAAA;AAAA,QACd,gBAAA;AAAA,QACA,eAAe,SAAA,CAAU,MAAA;AAAA,QACzB,UAAA,EAAY;AAAA;AACd,KACF;AAAA,EACF;AACF,CAAC,CAAA;AAGM,MAAM,oBAAoB,cAAA,CAAe;AAAA,EAC9C,EAAA,EAAI,qBAAA;AAAA,EACJ,WAAA,EAAa,yMAAA;AAAA,EACb,WAAA,EAAa,EAAE,MAAA,CAAO;AAAA,IACpB,KAAA,EAAO,EAAE,MAAA,EAAO;AAAA,IAChB,YAAY,CAAA,CAAE,MAAA,GAAS,QAAA,EAAS,CAAE,QAAQ,EAAE,CAAA;AAAA,IAC5C,UAAU,CAAA,CAAE,MAAA,GAAS,QAAA,EAAS,CAAE,QAAQ,IAAI,CAAA;AAAA,IAC5C,YAAA,EAAc,EAAE,MAAA,CAAO;AAAA,MACrB,SAAS,CAAA,CAAE,MAAA,GAAS,QAAA,EAAS,CAAE,QAAQ,IAAI,CAAA;AAAA,MAC3C,MAAM,CAAA,CAAE,MAAA,GAAS,QAAA,EAAS,CAAE,QAAQ,OAAO,CAAA;AAAA,MAC3C,QAAQ,CAAA,CAAE,MAAA,GAAS,QAAA,EAAS,CAAE,QAAQ,OAAO;AAAA,KAC9C,EAAE,QAAA;AAAS,GACb,CAAA;AAAA,EACD,YAAA,EAAc,EAAE,MAAA,CAAO;AAAA,IACrB,MAAA,EAAQ,EAAE,MAAA,EAAO;AAAA,IACjB,QAAA,EAAU,EAAE,MAAA,CAAO;AAAA,MACjB,KAAA,EAAO,EAAE,MAAA,EAAO;AAAA,MAChB,WAAA,EAAa,EAAE,MAAA,EAAO;AAAA,MACtB,cAAA,EAAgB,EAAE,MAAA,EAAO;AAAA,MACzB,YAAA,EAAc,EAAE,MAAA,EAAO;AAAA,MACvB,gBAAA,EAAkB,EAAE,MAAA,EAAO;AAAA,MAC3B,aAAA,EAAe,EAAE,MAAA,EAAO;AAAA,MACxB,UAAA,EAAY,EAAE,MAAA;AAAO,KACtB;AAAA,GACF;AACH,CAAC,CAAA,CACE,IAAA,CAAK,kBAAkB,CAAA,CACvB,IAAA,CAAK,yBAAyB,CAAA,CAC9B,IAAA,CAAK,wBAAwB,CAAA,CAC7B,IAAA,CAAK,2BAA2B,EAChC,MAAA,EAAO;;AC1mBV,MAAM,oBAAoB,UAAA,CAAW;AAAA,EACnC,EAAA,EAAI,gBAAA;AAAA,EACJ,WAAA,EAAa,oIAAA;AAAA,EACb,WAAA,EAAa,EAAE,MAAA,CAAO;AAAA,IACpB,KAAA,EAAO,CAAA,CAAE,MAAA,EAAO,CAAE,SAAS,wDAAW,CAAA;AAAA,IACtC,UAAA,EAAY,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,GAAW,OAAA,CAAQ,CAAC,CAAA,CAAE,QAAA,CAAS,4CAAS,CAAA;AAAA,IAC/D,KAAA,EAAO,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,GAAW,OAAA,CAAQ,QAAQ,CAAA,CAAE,QAAA,CAAS,wDAAW,CAAA;AAAA,IACnE,QAAA,EAAU,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,GAAW,OAAA,CAAQ,IAAI,CAAA,CAAE,QAAA,CAAS,4CAAS;AAAA,GACjE,CAAA;AAAA,EACD,YAAA,EAAc,EAAE,MAAA,CAAO;AAAA,IACrB,QAAA,EAAU,EAAE,MAAA,EAAO;AAAA,IACnB,cAAA,EAAgB,EAAE,MAAA,EAAO;AAAA,IACzB,UAAA,EAAY,EAAE,MAAA,EAAO;AAAA,IACrB,KAAA,EAAO,EAAE,MAAA;AAAO,GACjB,CAAA;AAAA,EACD,SAAS,OAAO,EAAE,SAAA,EAAW,cAAA,EAAgB,QAAO,KAAM;AACxD,IAAA,MAAM,EAAE,KAAA,EAAO,UAAA,EAAY,KAAA,EAAO,UAAS,GAAI,SAAA;AAE/C,IAAA,MAAM,SAAA,GAAY,KAAK,GAAA,EAAI;AAE3B,IAAA,IAAI;AACF,MAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,6DAAA,EAAiB,KAAK,CAAA,GAAA,EAAM,UAAU,CAAA,OAAA,CAAI,CAAA;AAGtD,MAAA,MAAM,UAAA,GAAa,cAAA,EAAgB,GAAA,CAAI,YAAY,CAAA;AACnD,MAAA,MAAM,QAAA,GAAW,cAAA,EAAgB,GAAA,CAAI,UAAU,CAAA;AAE/C,MAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,uEAAA,EAA2B,UAAU,CAAA,WAAA,EAAc,QAAQ,CAAA,CAAE,CAAA;AAGzE,MAAA,MAAM,KAAA,GAAQ,MAAA,EAAQ,QAAA,CAAS,eAAe,CAAA;AAC9C,MAAA,IAAI,CAAC,KAAA,EAAO;AACV,QAAA,MAAM,IAAI,MAAM,+DAAuB,CAAA;AAAA,MACzC;AAGA,MAAA,MAAM,WAAA,GAAc,aAAa,IAAA,GAC7B,CAAA,MAAA,EAAI,KAAK,CAAA,8BAAA,EAAQ,UAAU,iIAAwB,KAAK,CAAA;;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,EAAA,EAyB9D,KAAK,CAAA;AAAA;AAAA;AAAA;AAAA,gHAAA,CAAA,GAKC,CAAA,OAAA,EAAU,UAAU,CAAA,eAAA,EAAkB,KAAK,QAAQ,KAAK,CAAA,uCAAA,CAAA;AAG5D,MAAA,MAAM,EAAE,IAAA,EAAM,QAAA,EAAS,GAAI,MAAM,KAAA,CAAM,QAAA;AAAA,QACrC,WAAA;AAAA,QACA;AAAA,UACE,MAAA,EAAQ,cAAc,QAAA,GAAW;AAAA,YAC/B,QAAA,EAAU,UAAA;AAAA,YACV,MAAA,EAAQ;AAAA,WACV,GAAI;AAAA;AACN,OACF;AAGA,MAAA,IAAI,eAAA,GAAkB,SAAS,OAAA,CAAQ,kBAAA,EAAoB,EAAE,CAAA,CAAE,OAAA,CAAQ,aAAa,EAAE,CAAA;AACtF,MAAA,eAAA,GAAkB,gBAAgB,OAAA,CAAQ,cAAA,EAAgB,EAAE,CAAA,CAAE,OAAA,CAAQ,aAAa,EAAE,CAAA;AAErF,MAAA,MAAM,cAAA,GAAiB,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAEpC,MAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,yDAAA,EAAe,cAAc,CAAA,GAAA,CAAK,CAAA;AAC9C,MAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,gEAAA,EAAoB,eAAA,CAAgB,MAAM,CAAA,YAAA,CAAI,CAAA;AAE1D,MAAA,OAAO;AAAA,QACL,QAAA,EAAU,eAAA;AAAA,QACV,cAAA;AAAA,QACA,UAAA;AAAA,QACA;AAAA,OACF;AAAA,IACF,SAAS,KAAA,EAAO;AACd,MAAA,OAAA,CAAQ,KAAA,CAAM,2DAAc,KAAK,CAAA;AAGjC,MAAA,MAAM,YAAA,GAAe,CAAA;AAAA,YAAA,EACb,QAAQ,CAAA;AAAA;AAAA;AAAA;AAAA,WAAA,EAIT,KAAK,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,wEAAA,EA+EwD,UAAU,CAAA;AAAA;AAAA;AAAA;AAAA,gBAAA,EAIlE,KAAK,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,eAAA,EAMN,KAAA,YAAiB,KAAA,GAAQ,KAAA,CAAM,OAAA,GAAU,eAAe,CAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,OAAA,CAAA;AAuDnE,MAAA,MAAM,cAAA,GAAiB,IAAA,CAAK,GAAA,EAAI,GAAI,SAAA;AAEpC,MAAA,OAAO;AAAA,QACL,QAAA,EAAU,YAAA;AAAA,QACV,cAAA;AAAA,QACA,UAAA;AAAA,QACA;AAAA,OACF;AAAA,IACF;AAAA,EACF;AACF,CAAC,CAAA;AAGM,MAAM,0BAA0B,cAAA,CAAe;AAAA,EACpD,EAAA,EAAI,2BAAA;AAAA,EACJ,WAAA,EAAa,8HAAA;AAAA,EACb,WAAA,EAAa,EAAE,MAAA,CAAO;AAAA,IACpB,KAAA,EAAO,CAAA,CAAE,MAAA,EAAO,CAAE,SAAS,wDAAW,CAAA;AAAA,IACtC,UAAA,EAAY,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,GAAW,OAAA,CAAQ,CAAC,CAAA,CAAE,QAAA,CAAS,4CAAS,CAAA;AAAA,IAC/D,KAAA,EAAO,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,GAAW,OAAA,CAAQ,QAAQ,CAAA,CAAE,QAAA,CAAS,wDAAW,CAAA;AAAA,IACnE,QAAA,EAAU,CAAA,CAAE,MAAA,EAAO,CAAE,QAAA,GAAW,OAAA,CAAQ,IAAI,CAAA,CAAE,QAAA,CAAS,4CAAS;AAAA,GACjE,CAAA;AAAA,EACD,YAAA,EAAc,EAAE,MAAA,CAAO;AAAA,IACrB,QAAA,EAAU,EAAE,MAAA,EAAO;AAAA,IACnB,cAAA,EAAgB,EAAE,MAAA,EAAO;AAAA,IACzB,UAAA,EAAY,EAAE,MAAA,EAAO;AAAA,IACrB,KAAA,EAAO,EAAE,MAAA;AAAO,GACjB;AACH,CAAC,CAAA,CACE,IAAA,CAAK,iBAAiB,CAAA,CACtB,MAAA,EAAO;;ACtRH,MAAM,YAAA,GAAe,IAAI,MAAA,CAAO;AAAA,EACrC,OAAA,EAAS,IAAI,WAAA,CAAY;AAAA,IACvB,GAAA,EAAK;AAAA;AAAA,GACN,CAAA;AAAA,EACD,OAAA,EAAS;AAAA,IACP,YAAA,EAAc,EAAA;AAAA;AAAA,IACd,aAAA,EAAe;AAAA,MACb,OAAA,EAAS,IAAA;AAAA,MACT,QAAA,EAAU;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAOZ;AAEJ,CAAC,CAAA;;AChBM,MAAM,YAAA,GAAe,IAAI,KAAA,CAAM;AAAA,EACpC,IAAA,EAAM,eAAA;AAAA,EACN,YAAA,EAAc;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA,CAAA;AAAA,EAcd,KAAA,EAAO,UAAU,0BAA0B,CAAA;AAAA,EAC3C,KAAA,EAAO,EAAE,WAAA,EAAY;AAAA,EACrB,MAAA,EAAQ;AACV,CAAC,CAAA;;ACVM,SAAS,kBAAA,CAAmB,YAAoB,iBAAA,EAA0B;AAE/E,EAAA,IAAI,OAAA;AACJ,EAAA,IAAI,SAAA;AAEJ,EAAA,QAAQ,SAAA;AAAW,IACjB,KAAK,WAAA;AACH,MAAA,OAAA,GAAU,OAAO,eAAe,CAAA;AAChC,MAAA,SAAA,GAAY,EAAE,QAAA,EAAU,QAAA,EAAU,OAAA,EAAS,eAAA,EAAiB,aAAa,WAAA,EAAY;AACrF,MAAA;AAAA,IACF,KAAK,kBAAA;AACH,MAAA,OAAA,GAAU,OAAO,kBAAkB,CAAA;AACnC,MAAA,SAAA,GAAY,EAAE,QAAA,EAAU,QAAA,EAAU,OAAA,EAAS,kBAAA,EAAoB,aAAa,kBAAA,EAAmB;AAC/F,MAAA;AAAA,IACF,KAAK,iBAAA;AAAA,IACL;AACE,MAAA,OAAA,GAAU,UAAU,0BAA0B,CAAA;AAC9C,MAAA,SAAA,GAAY,EAAE,QAAA,EAAU,WAAA,EAAa,OAAA,EAAS,0BAAA,EAA4B,aAAa,iBAAA,EAAkB;AACzG,MAAA;AAAA;AAGJ,EAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,4CAAA,EAAe,SAAA,CAAU,WAAW,CAAA,EAAA,EAAK,UAAU,QAAQ,CAAA,GAAA,EAAM,SAAA,CAAU,OAAO,CAAA,CAAA,CAAG,CAAA;AAGjG,EAAA,OAAA,CAAQ,IAAI,CAAA,qBAAA,EAAwB,SAAA,CAAU,OAAO,CAAA,UAAA,EAAa,SAAA,CAAU,QAAQ,CAAA,CAAE,CAAA;AAEtF,EAAA,MAAM,KAAA,GAAQ,IAAI,KAAA,CAAM;AAAA,IACtB,IAAA,EAAM,sBAAA;AAAA,IACN,YAAA,EAAc;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,IAAA,CAAA;AAAA,IAqDd,KAAA,EAAO,OAAA;AAAA,IACP,OAAO,EAAE,WAAA,EAAa,eAAe,mBAAA,EAAqB,gBAAA,EAAkB,eAAe,aAAA,EAAc;AAAA,IACzG,MAAA,EAAQ;AAAA,GACT,CAAA;AAGD,EAAC,MAAsF,UAAA,GAAa,SAAA;AAEpG,EAAA,OAAO,KAAA;AACT;AAGO,MAAM,eAAe,kBAAA;;ACvGrB,MAAM,aAAA,GAAgB,IAAI,KAAA,CAAM;AAAA,EACrC,IAAA,EAAM,mBAAA;AAAA,EACN,YAAA,EAAc;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,EAAA,CAAA;AAAA,EAgBd,KAAA,EAAO,UAAU,0BAA0B,CAAA;AAAA,EAC3C,OAAO,EAAC;AAAA;AAAA,EACR,MAAA,EAAQ;AACV,CAAC;;ACbC,MAAW,MAAA,GAAA,IAAA,MAAA,CAAA;AAAA,EAAA,SAAA,EACT;AAAA,IACA,eAAA;AAAA,IACA,iBAAA;AAAA,IACF;AAAA,GACA;AAAA,EAAQ,MAAA,EACN;AAAA,IACA,YAAA;AAAA,IACA,YAAA;AAAA,IACF;AAAA,GACA;AAAA,EAAyB,OAAA,EAAA,IAAA,WAAA,CAAA;AAAA;AAAA,IAGxB,GAAA,EAAA;AAAA,GACD,CAAA;AAAA,EAAuB,MAAA,EACf,IAAA,UAAA,CAAA;AAAA,IACN,IAAA,EAAA,QAAA;AAAA,IAAiC,KAAA,EAAA,OAAA,CAAA,GAAA,CAAA,SAAA,IAAA;AAAA;AAAA,GAEpC;AAGD,CAAA;;;;"}