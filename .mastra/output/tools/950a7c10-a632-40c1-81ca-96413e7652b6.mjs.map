{"version":3,"file":"950a7c10-a632-40c1-81ca-96413e7652b6.mjs","sources":["../../../src/mastra/tools/slide-preview-tool.ts"],"sourcesContent":["import { createTool } from '@mastra/core/tools';\nimport { z } from 'zod';\nimport { getJobResult } from './job-status-tool';\n\nexport const slidePreviewTool = createTool({\n  id: 'slide-preview-display',\n  description: 'スライドプレビューを表示するためのトリガーツールです。このツールが実行されると、フロントエンドが自動的にスライドのプレビューを表示します。',\n  inputSchema: z.object({\n    jobId: z.string().describe('プレビューしたいスライド生成ジョブのID'),\n  }),\n  outputSchema: z.object({\n    jobId: z.string(),\n    previewReady: z.boolean(),\n    message: z.string(),\n  }),\n  execute: async ({ context }) => {\n    const { jobId } = context;\n    \n    console.log(`🖼️ スライドプレビュートリガー実行 (jobId: ${jobId})`);\n    \n    // ジョブ結果の存在確認のみ行う\n    const jobResult = getJobResult(jobId);\n    \n    if (!jobResult) {\n      return {\n        jobId,\n        previewReady: false,\n        message: `ジョブID「${jobId}」の結果が見つかりません。スライド生成が完了していない可能性があります。`,\n      };\n    }\n    \n    // ワークフローがスライド生成でない場合\n    if (jobResult.workflowId !== 'slideGenerationWorkflow') {\n      return {\n        jobId,\n        previewReady: false,\n        message: `ジョブID「${jobId}」はスライド生成ジョブではありません。`,\n      };\n    }\n    \n    // スライド生成結果の存在確認\n    const slideResult = jobResult.result;\n    \n    if (!slideResult || typeof slideResult !== 'object' || \n        !('htmlCode' in slideResult) || !slideResult.htmlCode) {\n      return {\n        jobId,\n        previewReady: false,\n        message: `ジョブID「${jobId}」のスライドHTMLコードが見つかりません。`,\n      };\n    }\n    \n    console.log(`✅ スライドプレビュー準備完了 (jobId: ${jobId})`);\n    \n    // トリガーとしての役割のみなので、HTMLコードは返さない\n    return {\n      jobId,\n      previewReady: true,\n      message: `スライドプレビューの準備が完了しました。プレビューが自動的に表示されます。`,\n    };\n  },\n}); "],"names":[],"mappings":";;;;;;AAIO,MAAM,mBAAmB,UAAA,CAAW;AAAA,EACzC,EAAA,EAAI,uBAAA;AAAA,EACJ,WAAA,EAAa,gaAAA;AAAA,EACb,WAAA,EAAa,EAAE,MAAA,CAAO;AAAA,IACpB,KAAA,EAAO,CAAA,CAAE,MAAA,EAAO,CAAE,SAAS,gHAAsB;AAAA,GAClD,CAAA;AAAA,EACD,YAAA,EAAc,EAAE,MAAA,CAAO;AAAA,IACrB,KAAA,EAAO,EAAE,MAAA,EAAO;AAAA,IAChB,YAAA,EAAc,EAAE,OAAA,EAAQ;AAAA,IACxB,OAAA,EAAS,EAAE,MAAA;AAAO,GACnB,CAAA;AAAA,EACD,OAAA,EAAS,OAAO,EAAE,OAAA,EAAQ,KAAM;AAC9B,IAAA,MAAM,EAAE,OAAM,GAAI,OAAA;AAElB,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,mHAAA,EAA+B,KAAK,CAAA,CAAA,CAAG,CAAA;AAGnD,IAAA,MAAM,SAAA,GAAY,aAAa,KAAK,CAAA;AAEpC,IAAA,IAAI,CAAC,SAAA,EAAW;AACd,MAAA,OAAO;AAAA,QACL,KAAA;AAAA,QACA,YAAA,EAAc,KAAA;AAAA,QACd,OAAA,EAAS,6BAAS,KAAK,CAAA,wNAAA;AAAA,OACzB;AAAA,IACF;AAGA,IAAA,IAAI,SAAA,CAAU,eAAe,yBAAA,EAA2B;AACtD,MAAA,OAAO;AAAA,QACL,KAAA;AAAA,QACA,YAAA,EAAc,KAAA;AAAA,QACd,OAAA,EAAS,6BAAS,KAAK,CAAA,kHAAA;AAAA,OACzB;AAAA,IACF;AAGA,IAAA,MAAM,cAAc,SAAA,CAAU,MAAA;AAE9B,IAAA,IAAI,CAAC,WAAA,IAAe,OAAO,WAAA,KAAgB,QAAA,IACvC,EAAE,UAAA,IAAc,WAAA,CAAA,IAAgB,CAAC,WAAA,CAAY,QAAA,EAAU;AACzD,MAAA,OAAO;AAAA,QACL,KAAA;AAAA,QACA,YAAA,EAAc,KAAA;AAAA,QACd,OAAA,EAAS,6BAAS,KAAK,CAAA,gHAAA;AAAA,OACzB;AAAA,IACF;AAEA,IAAA,OAAA,CAAQ,GAAA,CAAI,CAAA,8FAAA,EAA2B,KAAK,CAAA,CAAA,CAAG,CAAA;AAG/C,IAAA,OAAO;AAAA,MACL,KAAA;AAAA,MACA,YAAA,EAAc,IAAA;AAAA,MACd,OAAA,EAAS,CAAA,8NAAA;AAAA,KACX;AAAA,EACF;AACF,CAAC;;;;"}