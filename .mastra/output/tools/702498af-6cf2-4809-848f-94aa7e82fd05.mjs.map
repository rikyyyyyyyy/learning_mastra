{"version":3,"file":"702498af-6cf2-4809-848f-94aa7e82fd05.mjs","sources":["../../../src/mastra/tools/slide-generation-tool.ts"],"sourcesContent":["import { createTool } from '@mastra/core/tools';\nimport { z } from 'zod';\nimport { initializeJob, updateJobStatus, storeJobResult } from './job-status-tool';\n\nexport const slideGenerationTool = createTool({\n  id: 'slide-generation-queue',\n  description: '„Çπ„É©„Ç§„ÉâÁîüÊàê„Ç∏„Éß„Éñ„Çí„Ç≠„É•„Éº„Å´ÁôªÈå≤„Åó„ÄÅjobId„ÇíÂç≥Â∫ß„Å´Ëøî„Åó„Åæ„Åô„ÄÇÂÆüÈöõ„ÅÆ„Çπ„É©„Ç§„ÉâÁîüÊàêÂá¶ÁêÜ„ÅØ„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÅßÈùûÂêåÊúüÂÆüË°å„Åï„Çå„Åæ„Åô„ÄÇ',\n  inputSchema: z.object({\n    topic: z.string().describe('„Çπ„É©„Ç§„Éâ„ÅÆ„Éà„Éî„ÉÉ„ÇØ'),\n    slideCount: z.number().describe('„Çπ„É©„Ç§„Éâ„ÅÆÊûöÊï∞'),\n    style: z.string().describe('„Çπ„É©„Ç§„Éâ„ÅÆ„Çπ„Çø„Ç§„É´Ôºàmodern, minimal, corporate, creativeÔºâ'),\n    language: z.string().describe('„Çπ„É©„Ç§„Éâ„ÅÆË®ÄË™û'),\n  }),\n  outputSchema: z.object({\n    jobId: z.string().describe('„Ç∏„Éß„ÉñID'),\n    status: z.literal('queued').describe('„Ç∏„Éß„Éñ„Çπ„ÉÜ„Éº„Çø„Çπ'),\n    message: z.string().describe('„Çπ„ÉÜ„Éº„Çø„Çπ„É°„ÉÉ„Çª„Éº„Ç∏'),\n    estimatedTime: z.string().describe('Êé®ÂÆöÂÆå‰∫ÜÊôÇÈñì'),\n  }),\n  execute: async ({ context, runtimeContext }) => {\n    const { topic, slideCount = 5, style = 'modern', language = 'ja' } = context;\n    \n    // „Ç∏„Éß„ÉñID„ÇíÁîüÊàêÔºà„Çø„Ç§„É†„Çπ„Çø„É≥„Éó + „É©„É≥„ÉÄ„É†ÊñáÂ≠óÂàóÔºâ\n    const jobId = `slide-generation-${Date.now()}-${Math.random().toString(36).substring(2, 8)}`;\n    \n    // „Ç∏„Éß„ÉñÁä∂ÊÖã„ÇíÂàùÊúüÂåñ\n    initializeJob(jobId);\n    \n    // È´òÈÄü„É¨„Çπ„Éù„É≥„Çπ„ÅÆ„Åü„ÇÅ„Å´Âç≥Â∫ß„Å´jobId„ÇíËøî„Åô\n    const response = {\n      jobId,\n      status: 'queued' as const,\n      message: `„Çπ„É©„Ç§„ÉâÁîüÊàê„Ç∏„Éß„Éñ„Äå${topic}„Äç„Çí„Ç≠„É•„Éº„Å´ÁôªÈå≤„Åó„Åæ„Åó„ÅüÔºà${slideCount}Êûö„ÄÅ${style}„Çπ„Çø„Ç§„É´Ôºâ`,\n      estimatedTime: '15-30ÁßíÁ®ãÂ∫¶',\n    };\n    \n    // „Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„Åß„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÇíÈùûÂêåÊúüÂÆüË°å\n    // ÈÅÖÂª∂Ë™≠„ÅøËæº„Åø„ÅßMastra„Ç§„É≥„Çπ„Çø„É≥„Çπ„ÇíÂèñÂæó\n    setTimeout(() => {\n      import('../index').then(({ mastra: mastraInstance }) => {\n        if (mastraInstance) {\n          executeWorkflowInBackground(mastraInstance, jobId, { topic, slideCount, style, language }, runtimeContext)\n            .catch(error => {\n              console.error(`„Çπ„É©„Ç§„ÉâÁîüÊàê„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÂÆüË°å„Ç®„É©„Éº (jobId: ${jobId}):`, error);\n            });\n        } else {\n          console.error(`Mastra„Ç§„É≥„Çπ„Çø„É≥„Çπ„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì (jobId: ${jobId})`);\n          updateJobStatus(jobId, 'failed', { error: 'Mastra„Ç§„É≥„Çπ„Çø„É≥„Çπ„ÅåÂà©Áî®„Åß„Åç„Åæ„Åõ„Çì' });\n        }\n      }).catch(error => {\n        console.error(`Mastra„Ç§„É≥„Çπ„Çø„É≥„ÇπË™≠„ÅøËæº„Åø„Ç®„É©„Éº (jobId: ${jobId}):`, error);\n        updateJobStatus(jobId, 'failed', { error: 'Mastra„Ç§„É≥„Çπ„Çø„É≥„Çπ„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü' });\n      });\n    }, 0);\n    \n    return response;\n  },\n});\n\n// „Éê„ÉÉ„ÇØ„Ç∞„É©„Ç¶„É≥„Éâ„Åß„ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÇíÂÆüË°å„Åô„ÇãÈñ¢Êï∞\nasync function executeWorkflowInBackground(\n  mastra: unknown, \n  jobId: string, \n  inputData: { topic: string; slideCount?: number; style?: string; language?: string },\n  runtimeContext?: unknown\n) {\n  try {\n    console.log(`üöÄ „Çπ„É©„Ç§„ÉâÁîüÊàê„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÈñãÂßã (jobId: ${jobId})`);\n    updateJobStatus(jobId, 'running');\n    \n    const mastraInstance = mastra as { getWorkflow: (id: string) => unknown };\n    const workflow = mastraInstance.getWorkflow('slideGenerationWorkflow');\n    if (!workflow) {\n      throw new Error('slideGenerationWorkflow„ÅåË¶ã„Å§„Åã„Çä„Åæ„Åõ„Çì');\n    }\n\n    const workflowInstance = workflow as { \n      createRunAsync: (options: { runId: string }) => Promise<{\n        watch: (callback: (event: { type: string; payload?: { id?: string } }) => void) => void;\n        start: (options: { inputData: unknown; runtimeContext?: unknown }) => Promise<{\n          status: 'success' | 'failed' | 'suspended';\n          result?: unknown;\n          error?: { message?: string };\n          suspended?: unknown;\n        }>;\n      }>\n    };\n    const run = await workflowInstance.createRunAsync({ runId: jobId });\n    \n    // ÈÄ≤ÊçóÁõ£Ë¶ñ„ÇíË®≠ÂÆö\n    run.watch((event: { type: string; payload?: { id?: string } }) => {\n      console.log(`üìä „Çπ„É©„Ç§„ÉâÁîüÊàê„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÈÄ≤Êçó (${jobId}):`, event.type, event.payload?.id || '');\n    });\n    \n    // „ÉØ„Éº„ÇØ„Éï„É≠„Éº„ÇíÂÆüË°åÔºàruntimeContext„ÇíÊ∏°„ÅôÔºâ\n    const result = await run.start({ \n      inputData,\n      runtimeContext \n    });\n    \n    if (result.status === 'success') {\n      console.log(`‚úÖ „Çπ„É©„Ç§„ÉâÁîüÊàê„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÂÆå‰∫Ü (jobId: ${jobId})`);\n      const slideResult = result.result as { slideCount?: number; style?: string } | undefined;\n      console.log(`üé® „Çπ„É©„Ç§„ÉâÁîüÊàêÂÆå‰∫Ü: ${slideResult?.slideCount}Êûö (${slideResult?.style}„Çπ„Çø„Ç§„É´)`);\n      \n      // „Ç∏„Éß„ÉñÁä∂ÊÖã„ÇíÊõ¥Êñ∞\n      updateJobStatus(jobId, 'completed', { result: result.result });\n      \n      // „ÉØ„Éº„ÇØ„Éï„É≠„ÉºÁµêÊûú„ÇíÂ∞ÇÁî®„Çπ„Éà„É¨„Éº„Ç∏„Å´Ê†ºÁ¥ç\n      storeJobResult(jobId, result.result, 'slideGenerationWorkflow');\n      \n    } else if (result.status === 'failed') {\n      console.error(`‚ùå „Çπ„É©„Ç§„ÉâÁîüÊàê„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÂ§±Êïó (jobId: ${jobId}):`, result.error);\n      updateJobStatus(jobId, 'failed', { error: result.error?.message || 'Unknown error' });\n      \n    } else if (result.status === 'suspended') {\n      console.log(`‚è∏Ô∏è „Çπ„É©„Ç§„ÉâÁîüÊàê„ÉØ„Éº„ÇØ„Éï„É≠„Éº‰∏≠Êñ≠ (jobId: ${jobId}):`, result.suspended);\n      // ‰∏≠Êñ≠Áä∂ÊÖã„ÅØÁâπÂà•„Å™Âá¶ÁêÜ„ÅåÂøÖË¶Å„Å™Â†¥Âêà„Åå„ÅÇ„Çã„Åü„ÇÅ„ÄÅ„Åì„Åì„Åß„ÅØÁä∂ÊÖã„ÇíÊõ¥Êñ∞„Åó„Å™„ÅÑ\n      \n    }\n    \n  } catch (error) {\n    console.error(`üí• „Çπ„É©„Ç§„ÉâÁîüÊàê„ÉØ„Éº„ÇØ„Éï„É≠„ÉºÂÆüË°å‰∏≠„ÅÆËá¥ÂëΩÁöÑ„Ç®„É©„Éº (jobId: ${jobId}):`, error);\n    updateJobStatus(jobId, 'failed', { \n      error: error instanceof Error ? error.message : 'Unknown error' \n    });\n  }\n} "],"names":[],"mappings":"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"}